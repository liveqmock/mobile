(function(a){function b(b){var c=a("#youi_loading");c.length||(c=a('<div class="youi-loading" id="youi_loading"/>').appendTo(a("body",document)));b=b||a.youi.resourceUtils.get("loading");a("body",document).addClass("show-loading");c.show().text(b).css({height:Math.max(a(window).height(),a("body",document).height())})}function c(){a("#youi_loading").hide();a("body",document).removeClass("show-loading")}function d(b,c){var g=a("#youi_log");g.length==0&&(g=a('<div class="youi-log" id="youi_log"></div>').appendTo(a("body",
document)));g.prepend('<div class="'+(c.type||"")+'">'+g.find("div").length+":"+b+"</div>");g.dialog({autoOpen:false,width:500,title:"\u65e5\u8bb0",minHeight:500,zIndex:1002}).dialog("open").show()}function e(b){a.youi.serverConfig.contextPath&&b.substring(0,1)=="/"&&b.indexOf(a.youi.serverConfig.contextPath)==-1&&(b=a.youi.serverConfig.contextPath+b.substring(1));return b}a.youi=a.youi||{};a.youi.extensions={};a.youi.abstractExtension={order:0,beforeCreate:function(){},afterCreate:function(){},actionDelegate:function(){}};
a.youi.getMessage=function(b,c){if(arguments.length==1)return function(){var c=a.makeArray(arguments);c.unshift(b);return a.youi.getMessage.apply(this,c)};arguments.length>2&&c.constructor!=Array&&(c=a.makeArray(arguments).slice(1));c.constructor!=Array&&(c=[c]);a.each(c,function(a,c){b=b.replace(RegExp("\\{"+a+"\\}","g"),""+c)});return b};a(window).bind("resize",function(){window.setTimeout(function(){a("body",document).trigger("body.resize")})});a.extend(a.youi,{version:"1.0.0",serverConfig:{contextPath:"",
convertArray:[]},logLevel:0,log:{info:function(b){a.youi.logLevel>3&&d(b,{type:"info"})},debug:function(b){a.youi.logLevel>2&&d(b,{type:"debug"})},warn:function(b){a.youi.logLevel>1&&d(b,{type:"warn"})},error:function(b){a.youi.logLevel>0&&d(b,{type:"error"})}},resource:{},resourceUtils:{get:function(b){var c=a.youi.resource[b];return!c?"":a.isFunction(c)?c(Array.prototype.slice.call(arguments,1)):c}},eventUtils:{bodyClick:function(){a("body",document).trigger("body.click")}},classUtils:{hasClass:function(a,
b){return!a?false:(" "+a.className+" ").indexOf(" "+b+" ")!=-1},getEventClass:function(a){if(a)return(a=a.target.className)&&(a=a.split(" ")[0]),a}},stringUtils:{notEmpty:function(a){return a}},htmlUtils:{buildIconHtml:function(a){return'<span class="youi-icon '+a+'"></span>'}},getWidget:function(b,c){return a.data(b,"youi-"+c)},pageUtils:{loadPage:function(f,d,g){b();window.setTimeout(function(){d=e(d);f.load(d,function(b,f){c();"error"==f&&a(this).html(b);var d=a(".youi-page:first",this).attr("id");
d&&d.length>2&&a.youi.pageUtils.loadPageScript(d.substring(2),function(){a.isFunction(g)&&g.apply(this)})})})},element:function(b,c){var g=b;c&&(g="P_"+c+"_"+b);return a("#"+g)},goPage:function(b,c){for(var g=e(b),d=a('<form action="'+g+'" method="post" target="_blank"></form>'),g=a.youi.recordUtils.recordToParameters(c),k=0;k<g.length;k++){var j=a('<input name="'+g[k].property+'" type="hidden"/>');j.val(g[k].value);d.append(j)}a("body",document).append(d);window.setTimeout(function(){d[0].submit();
d.remove()})},doPageFunc:function(b,c,g){b="P_"+c+"_"+b;a.isFunction(window[b])&&window[b].apply(g)},loadPageScript:function(b,c,g){if(b){var d=a.youi.serverConfig.contextPath+"scripts/page/"+b+".html";if(jQuery.support.style){a("script#script_"+b).remove();var e=document.createElement("script");e.setAttribute("id","script_"+b);e.setAttribute("type","text/javascript");e.setAttribute("src",d);a("body",document)[0].parentNode.appendChild(e);a(e).bind("load",function(){if(!this.hasLoaded)this.hasLoaded=
true,a.isFunction(c)&&c(g)})}else a.getScript(d,function(){c(g)})}}},buttonUtils:{addButtonActionListener:function(b,c){b.delegate(".youi-button","click",function(b){var f=this.getAttribute("id");if(a(this).hasClass("disabled"))return false;if("button_closeDialog"==f)a(this).parents(".youi-subpage.youi-dialog:first").dialog("close");else if(f&&f.indexOf("button_")==0){var f=f.substring(7),d=c[f];typeof d=="string"&&(d=window[d]);!d&&a.isFunction(window["func_button_"+f])&&(d=window["func_button_"+
f]);a.isFunction(d)&&(a(".youi-button",b.delegateTarget).not(this).removeClass("active"),a(this).addClass("active"),d.apply(this,[b.delegateTarget]))}})},createButton:function(b){var c=[],g=["youi-button",b.disabled?"disabled":""].concat(b.buttonStyles);c.push('<div id="button_'+b.name+'" class="'+g.join(" ")+'"><div class="right"><div class="center"><a href="#"');c.push('class="'+b.name+" "+(b.icon?"icon "+b.icon:"")+'"');c.push(">");c.push(b.caption);c.push("</a></div></div></div>");a.isFunction(b.action)&&
a.actionFactory.register(b.id,b.action);return c.join("")},createButtons:function(b){var c=[];if(a.isArray(b)){c.push('<table cellpadding="1" cellspacing="0">');c.push("<tr>");for(var g=0;g<b.length;g++)c.push("<td>"),c.push(a.youi.buttonUtils.createButton(b[g])),c.push("</td>");c.push("</tr>");c.push("</table>")}return c.join("")}},popUtils:{showPopBackground:function(){var b=a("#youi-pop-background");b.length==0&&(b=a('<div id="youi-pop-background"></div>').appendTo(a("body",document)),b.disableSelection());
var c=Math.max(a(window).height(),a("body",document).height());b.show().css("height",c)},hidePopBackground:function(){a("#youi-pop-background").length&&a("#youi-pop-background").hide()}},recordUtils:{records2Htmls:function(b,c){if(!a.isArray(b)||b.length==0)return"";var g,d,e=[],j=c.propertyDescriptor;j||(e=b);for(var m=[],l=0;l<b.length;l++)if(g=b[l]){if(j){d={};for(var o in j)d[o]=g[j[o]];e.push(d)}else d=g;if(a.isFunction(c.parseRecord)){d=c.parseRecord(l,d,c)||"";g=[];g=a.isArray(d)?d:[d];for(d=
0;d<g.length;d++)m[d]=!m[d]?[]:m[d],m[d].push(g[d]||"")}}return a.isFunction(c.parse)?c.parse(e,m,c):[]},getPropertyValue:function(a,b){if(b){var c,d=b.split(".");if(d.length>1){c=a;for(var e=0;e<d.length;e++)if(c=c[d[e]],!c)return}else c=a[b];return c}},recordToParameters:function(b){var c=[];if(b)for(var g in b){var d=b[g];d&&(typeof d=="string"?c.push({property:g,value:d}):d&&a.isArray(d)&&(typeof d[0]=="object"?a(d).each(function(a){for(var b in this)c.push({property:g+"["+a+"]."+b,value:this[b]})}):
a(d).each(function(a){c.push({property:g+"["+a+"]",value:this})})));d=null}return c}},parameterUtils:{propertyParameter:function(b,c){var d=[];a.isArray(c)?a(c).each(function(){this!=null&&d.push(""+b+"="+encodeURIComponent(this))}):c&&d.push(""+b+"="+encodeURIComponent(c));return d.join("&")},connectParameter:function(b,c,d){return b+(b.indexOf("?")==-1?"?":"&")+a.youi.parameterUtils.propertyParameter(c,d)}},dimensionUtil:{parseWidth:function(a,b){return typeof b=="string"&&b.indexOf("%")!=-1?a.parent().width()*
parseInt(b)/100:b}},messageUtils:{showMessage:function(a){a&&alert(a)},showError:function(a){a&&alert(a)}},ajaxUtil:{ajax:function(d,e){if(d.url){b(d.wait);if(a.youi.serverConfig.contextPath&&d.url.substring(0,1)=="/"&&d.url.indexOf(a.youi.serverConfig.contextPath)==-1)d.url=a.youi.serverConfig.contextPath+d.url.substring(1);var g=a.extend({},{dataType:"json",type:"POST",contentType:"application/x-www-form-urlencoded;charset=UTF-8",error:function(){}},d),i=g.success||function(){},k=g.error||function(){},
j=g.domainValidator||function(){};g.complete=function(b,d){if(d=="error"){var f=a.youi.resourceUtils.get("urlNotFound",this.url);a.youi.messageUtils.showError(f);this.error.apply(g,[f])}c()};g.success=function(b){c();a.youi.ajaxUtil.resultsCheck(b,{error:k,domainValidator:j})&&i.apply(g,[b])};a.ajax(g)}else a.youi.messageUtils.showError("\u6ca1\u6709ajax url\u53c2\u6570\uff01")},resultsCheck:function(b,c){if(b==null)return false;if(b.hasError)return a.youi.messageUtils.showError(b.errorMsg),c.error.apply(c,
[b.errorMsg]),false;b.result&&b.result.message&&a.youi.messageUtils.showMessage(b.result.message);var d=b.message;if(d&&d.code){var e=d.code;switch(e){case "000000":d.passed==null&&a.youi.messageUtils.showMessage(d.info);break;case "111111":a.youi.messageUtils.showMessage(e+":"+d.info);window.location.href=window.location.href;return;case "111112":c.domainValidator.apply(c,[b]);return;default:a.youi.messageUtils.showError(d.info);c.error.apply(c,[d.info]);return}}return true}},command:{_initCommands:function(){this.commands=
[];this.undoCommands=[];this.registedCommands=[]},executeCommand:function(b,c){if(b=="redo"||b=="undo")this[b](),a.isFunction(this.options.afterCommand)&&this.options.afterCommand.apply(this.element[0],[this.commands,this.undoCommands]);else if(typeof b=="string"&&this.registedCommands[b]){c=a.extend({editorId:this.options.id},b.defaults,c);b=a.extend({options:c},this.registedCommands[b]);this.commands.push(b);var d=this.exec();d!==null&&d===false?this.commands.pop():(a.youi.log.info("\u6267\u884c\u52a8\u4f5c\uff1a"+
b.getTitle.apply(b.options)),this.undoCommands=[],a.isFunction(this.options.afterCommand)&&this.options.afterCommand.apply(this.element[0],[this.commands,this.undoCommands]))}},exec:function(a){if(this.commands.length>0){var b=this.commands[this.commands.length-1];return b.exec.apply(b.options,[a])}},undo:function(){if(this.commands.length>0){var b=this.commands.pop();b.undo.apply(b.options);this.undoCommands.push(b);a.youi.log.info("\u64a4\u9500\u52a8\u4f5c\uff1a"+b.getTitle.apply(b.options))}},
redo:function(){if(this.undoCommands.length>0){var b=this.undoCommands.pop();this.commands.push(b);this.exec(true);a.youi.log.info("\u91cd\u505a\u52a8\u4f5c\uff1a"+b.getTitle.apply(b.options))}},registerCommand:function(a,b){this.registedCommands[a]=b;return a},getCommands:function(){return[].concat(this.commands)},getUndoCommands:function(){return[].concat(this.undoCommands)}},dragSupport:{_doDrag:function(a){if(a[0]!=this.currentDrag[0]&&(this.currentDrop&&this.currentDrop[0]!=a[0]&&this._dropOut(),
!this.currentDrop||this.currentDrop[0]!=a[0]))this.currentDrop=a,this._dropOver()},_releaseDrop:function(){this.currentDrop&&this._dropOut();this.currentDrop=null},_dropOver:function(){this.helper&&this.helper.addClass("drop-yes");this.currentDrop&&this.currentDrop.addClass("droping")},_dropOut:function(){this.helper&&this.helper.removeClass("drop-yes");this.currentDrop&&this.currentDrop.removeClass("droping")},_createHelper:function(b,c){var d=a('<div class="drop-yes" id="drag_helper"></div>').append(c.clone());
d.parents("body").length||d.appendTo(this.options.container?this.options.container:this.currentDrag);d[0]!=this.element[0]&&!/(fixed|absolute)/.test(d.css("position"))&&d.css("position","absolute");return d},_generatePosition:function(a){var b=a.pageX,a=a.pageY,c=this.options.container?this.options.container.offset():this.element.offset(),c=c?c:{top:0,left:0};return{top:a+10-c.top,left:b+5-c.left}}}})})(jQuery);(function(a){a.youi.fieldUtils={getInstance:function(b){return(b=a(b))&&b.is(".youi-field")?a.data(b[0],"youi-"+b.attr("fieldType")):null},execMethod:function(b,c){if(!(b===null||c===null||typeof c!="string")){var d=a.youi.fieldUtils.getInstance(b);if(d!==null&&d._init&&d[c]){var e=Array.prototype.slice.call(arguments,2);d[c].apply(d,e)}}},getElementByProperty:function(b,c){var d=a.youi.fieldUtils.getFieldId(b,c);return a.youi.fieldUtils.getElementById(d)},getRelElementByProperty:function(b,c,d){return b.indexOf(d)>
0?a.youi.fieldUtils.getElementByProperty(c,b.split(d)[0]+d):a.youi.fieldUtils.getElementByProperty(c,d)},getElementById:function(b){return a(document.getElementById(b))},getFieldId:function(a,c){return!a?null:(c?c:"field")+"_"+a.replace(/\./g,"_")}};a.extend(jQuery.fn,{fieldValue:function(b,c){var d=a.youi.fieldUtils.getInstance(this);if(d)if(arguments.length==0)return d.getValue();else d.setValue(b,c);return null},fieldDefaultValue:function(b){var c=a.youi.fieldUtils.getInstance(this);if(c&&b)c.options.defaultValue=
b},fieldShow:function(){var b=a.youi.fieldUtils.getInstance(this);return b?b.getText()||b.getValue():null},fieldReset:function(b){this.each(function(){var c=a.youi.fieldUtils.getInstance(this);c&&!(b==true&&c.options.escapeReset==true)&&c.reset&&c.reset()})},fieldFocus:function(){var b=a.youi.fieldUtils.getInstance(this);b&&b.focus()},fieldValidate:function(){this.each(function(){var b=a.youi.fieldUtils.getInstance(this);b&&b.validate&&b.validate()})},fieldClear:function(){this.each(function(){var b=
a.youi.fieldUtils.getInstance(this);b&&b.clear()})},fieldWidth:function(b){var c=a.youi.fieldUtils.getInstance(this);if(c)if(arguments.length==0)return c.getWidth();else c.setWidth(b);return null},fieldDisabled:function(){this.each(function(){var b=a.youi.fieldUtils.getInstance(this);b&&b.disabled()})},fieldEnable:function(){this.each(function(){var b=a.youi.fieldUtils.getInstance(this);b&&b.enable()})}});a.youi.field={_create:function(){this.options.id=this.options.id||a.youi.fieldUtils.getFieldId(this.options.property,
this.options.prefix);this.element.attr("fieldType",this.widgetName).attr("property",this.options.property);this._defaultHtmls();this._initField();this._initAction();this.reset()},_defaultHtmls:function(){if(this.options.initHtml!==false){var a=this._fieldHtmls(),c=["youi-field",this.widgetName];this.options.notNull==true&&c.push("notNull");this.element.attr("id",this.options.id).addClass(c.join(" ")).html(a)}},_fieldHtmls:function(){return""},_initField:function(){},_initAction:function(){},_validateNotNull:function(){if(this.options.notNull==
null)return true;var b=this.getValue();if(this.options.notNull==true){if(a.isArray(b)&&b.length==0)return this._validateError("\u4e0d\u80fd\u4e3a\u7a7a"),false;if(typeof b=="string"&&(b==""||b==null))return this._validateError("\u4e0d\u80fd\u4e3a\u7a7a"),false}return true},_validateSuccess:function(){this.element.removeClass("validate-error").addClass("validate-success").removeAttr("title")},_validateError:function(a){a=a||"";this.element.removeClass("validate-success").addClass("validate-error").attr("title",
"\u3010"+this.options.caption+"\u3011"+a)},_validating:function(){this.element.removeClass("validate-success").removeClass("validate-success").addClass("validating").removeAttr("title")},getValue:function(){},setValue:function(){},getText:function(){},setText:function(){},clear:function(){},focus:function(){},validate:function(){this.element.removeClass("validate-success").removeClass("validate-error").removeAttr("title");this._validateNotNull()},reset:function(){this.element.removeClass("validate-success").removeClass("validate-error").removeAttr("title");
this.options.defaultValue!=null?this.setValue(this.options.defaultValue,this.options.defaultShow):this.clear()},setWidth:function(a){this.element.width(a).find(".textInput").width(a)},disabled:function(){this.element.addClass("disabled").find(".textInput").attr("disabled","disabled")},enable:function(){this.element.removeClass("disabled").find(".textInput").removeAttr("disabled","disabled")},destory:function(){this.element.removeClass("youi-field").removeAttr("fieldType").removeAttr("property");a.Widget.prototype.destroy.apply(this,
arguments)}};a.youi.fieldSource={children:[],_fieldHtmls:function(){var a=this.options.width-11,c=this.options.showProperty,d=[];d.push('<table cellpadding="0" cellspacing="0" width="'+a+'"><tbody><tr>');d.push('<td valign="top" width="'+(a-15)+'"><input style="width:'+(a-15-4)+'px;" type="text" ');d.push(c==null?"":'showProperty="'+c+'"');d.push(' readonly="readonly" class="textInput"/><input name="'+this.options.property+'" type="hidden" class="value"/></td>');d.push('<td class="youi-icon select-down"></td>');
d.push("</tr></tbody></table>");this.element.html(d.join(""))},_initSource:function(){this._getPopPanel&&this._getPopPanel();this.children=[];var b=this.options.parents;if(a.isArray(b)&&b.length>0)for(var c,d=0;d<b.length;d++)(c=a.youi.fieldUtils.getRelElementByProperty(this.options.id,b[d],this.options.prefix))&&a.youi.fieldUtils.execMethod(c,"_addChild",this.options.property)},_addChild:function(a){this.children.push(a)},_resetChildren:function(){var b=this.children;if(a.isArray(b)&&b.length>0)for(var c,
d=0;d<b.length;d++)(c=a.youi.fieldUtils.getRelElementByProperty(this.options.id,b[d],this.options.prefix))&&a.youi.fieldUtils.execMethod(c,"_reloadByParent",this.options.property)},_reloadByParent:function(){this.reset();this._disposeLoaded();this._resetChildren()},_getDatasContextId:function(){return this.id+"-datasContext"},_parseRecords:function(b,c){var d=this._getDatasContextId();a("#"+d).removeClass("item-srcoll");var e={property:this.options.property,propertyDescriptor:{code:this.options.code,
show:this.options.show},parseRecord:this._parseRecord,selectedValue:this.getValue(),selectedTexts:[],datasContextId:d,fieldId:this.options.id,mixed:this.options.mixed,parse:function(b,c,d){b.length>10&&a("#"+d.datasContextId).addClass("item-srcoll");d.selectedTexts.length>0&&a.youi.fieldUtils.execMethod(a("#"+d.fieldId),"setText",d.selectedTexts.join());return c[0].join("")}},f=[];this.options.notNull!=true&&f.push(this._nullItemHtml());f.push(a.youi.recordUtils.records2Htmls(b,e));d=a("#"+d);d[0].innerHTML=
f.join("");d.addClass("loaded "+(c?"expanded":""))},_parseRecord:function(){},_nullItemHtml:function(){return""},_isLoaded:function(){var b=this._getDatasContextId();return a("#"+b).hasClass("loaded")},_disposeLoaded:function(){a("#"+this._getDatasContextId()).removeClass("loaded")},_datasLoader:function(a){this.options.convert?this._convertLoader(a):this.options.src&&this._ajaxLoader(a)},_convertLoader:function(){var b=a.youi.serverConfig.convertArray[this.options.convert];if(b){var c=[];this.options.code=
"code";this.options.show="show";for(var d in b)c.push({code:d,show:b[d]});this._parseRecords(c)}},_ajaxLoader:function(b){var c=this.options.src,d=[],d=this._getParentParameters();if(!d)return false;d=[].concat(d);a.youi.ajaxUtil.ajax({fieldId:this.options.id,url:c,data:d.join("&"),success:function(c){if(c&&a.isArray(c.records)){var d=a.youi.fieldUtils.getElementById(this.fieldId);a.youi.fieldUtils.execMethod(d,"_parseRecords",c.records,b)}}})},_getParentParameters:function(){var b=[],c=this.options.parents,
d=this.options.parentsAlias||[],e;if(a.isArray(c)&&c.length>0){for(var f,h,g=[],i=0;i<c.length;i++)if((f=a.youi.fieldUtils.getRelElementByProperty(this.options.id,c[i],this.options.prefix))&&f.length)h=f.fieldValue(),e=d[i]||c[i],h||(f=a("label[for="+f.attr("fieldtype")+"-"+f.attr("id")+"]"),g.push(f.text())),b.push(a.youi.parameterUtils.propertyParameter(e,h));if(g.length)throw"\u8bf7\u5148\u9009\u62e9\u3010"+g.join().replace("\uff1a","")+"\u3011";}return b},reset:function(){var b=this.options.parents;
a.isArray(b)&&b.length>0&&(b=this._getDatasContextId(),a("#"+b).removeClass("loaded"));a.youi.field.reset.apply(this)}};a.youi.fieldPop=a.extend({},a.youi.fieldSource,{_fieldHtmls:function(){var a=[],c=this.options.width-11;a.push('<table class="fieldPop-table" cellpadding="0" cellspacing="0" width="'+c+'"><tbody><tr>');a.push('<td valign="top" width="'+(c-15)+'"><input readonly="readonly" style="width:'+(c-15-6)+'px;" type="text" class="textInput fieldPop"></input><input  name="'+this.options.property+
'" type="hidden" class="value"></input></td>');a.push('<td class="youi-icon select-down"></td>');a.push("</tr></tbody></table>");return a.join("")},_initAction:function(){this.options.readonly!=true&&(this.element.bind("click",function(){!a(this).hasClass("readonly")&&!a(this).hasClass("disabled")&&a.youi.fieldUtils.execMethod(this,"_togglePanel")}),a("body",document).hasClass("event-fieldPop")||(a(document).bind("mousedown",function(b){a(".field-items-panel").removeClass("expanded");a.youi.popUtils.hidePopBackground();
b.target.getAttribute("id")==="youi-pop-background"&&a.youi.editorFactory&&a.youi.editorFactory.closeEditor()}),a(window).bind("resize",function(){a(".field-items-panel").removeClass("expanded");a.youi.popUtils.hidePopBackground()}),a("body",document).addClass("event-fieldPop")),this._initPanelAction())},_togglePanel:function(){this.options.popup!=false&&(this._getPopPanel().toggleClass("expanded").hasClass("expanded")?this._openPanel():this._closePanel())},_openPanel:function(){var b=this._getPopPanel();
if(this._isLoaded()){b.find(".selected").removeClass("selected");for(var c=this.getValue(),d=[],d=a.isArray(c)?c:[c],c=0;c<d.length;c++)b.find(".option-item[value="+d[c]+"]").addClass("selected")}else try{this._datasLoader(true)}catch(e){b.empty();alert(e);return}this._setPanelPosition();b.addClass("expanded");a.youi.popUtils.showPopBackground(a(window).width()-10)},_closePanel:function(){this.options.popup!=false&&(this._getPopPanel().removeClass("expanded"),a.youi.popUtils.hidePopBackground())},
_getPopPanel:function(){var b=this._getPanelId(),c=a("#"+b);c.length==0?(c=a('<div fieldId="'+this.options.id+'" style="width:'+(this.options.width-11)+'px;" id="'+b+'" class="field-items-panel"></div>').appendTo(a("body",document)),c.html(this._popPanelHtmls())):this.options.popup&&!c.parent().is("body")&&c.appendTo(a("body",document));return c},_popPanelHtmls:function(){return""},_getPanelId:function(){return"field-pop-"+this.options.id},_setPanelPosition:function(){this._getPopPanel().css({left:this.element.offset().left,
top:this.element.offset().top+this.element.innerHeight()-1,width:this.element.width()-2})},_initPanelAction:function(){},setText:function(a){this.element.find("input.textInput").val(a)},getText:function(){return this.element.find("input.textInput").val()},clear:function(){this.element.find("input.textInput,input.value").val("")},focus:function(){},setWidth:function(a){this.element.find("table").attr("width",a+"px").find("td:first").attr("width",a-15+"px");this._getPopPanel().width("width",a);this.element.width(a).find(".textInput").width(a-
15)},destroy:function(){this.element.removeClass("youi-field").removeAttr("fieldType").removeAttr("property");this._getPopPanel().remove();a.Widget.prototype.destroy.apply(this,arguments)}});a.youi.fieldDefaults={width:200};a.youi.fieldSourceDefaults=a.extend({},a.youi.fieldDefaults,{show:"show",value:"value"});a.youi.fieldPopDefaults=a.extend({},a.youi.fieldSourceDefaults,{popup:true});a.widget("youi.fieldCustom",a.extend({},a.youi.field,{_initField:function(){},setValue:function(a){this.options.setValue(a)},
getValue:function(){return this.options.getValue(value)},clear:function(){this.options.clear(value)}}))})(jQuery);(function(a){a.widget("youi.fieldAutocomplete",a.extend({},a.youi.field,a.youi.fieldSource,{_initField:function(){var a=this;this._initSource();this.element.find("input.textInput").autocomplete({source:this.options.src,code:this.options.code,show:this.options.show,term:this.options.property,select:function(c,d){var e=d.item;a.setValue(e.value,e.value)},search:function(){},response:function(){},close:function(){},messages:{noResults:"",results:function(){return""}}})},_fieldHtmls:function(){var a=
[];a.push('<input style="width:'+(this.options.width-17)+'px;" type="text" class="textInput"></input>');a.push('<input type="hidden" class="value"></input>');a.push('<div class="field-invalid"></div>');return a.join("")},setValue:function(a,c){this.element.find("input.textInput").val(c||a);this.element.find("input.value").val(a);this._resetChildren()},_reloadByParent:function(){this.clear();this._disposeLoaded();this._resetChildren()},getValue:function(){return this.element.find("input.value").val()},
clear:function(){this.element.removeClass("validate-success").removeClass("validate-error").removeAttr("title");this.element.find("input.value,input.textInput").val("")},_initAction:function(){}}));a.extend(a.youi.fieldAutocomplete,{defaults:a.extend({},a.youi.fieldDefaults,{})})})(jQuery);(function(a){a.widget("youi.fieldCalendar",a.extend({},a.youi.field,{options:{textFormat:"yyyy-MM-dd HH:mm:ss",format:"yyyy-MM-dd HH:mm:ss"},_initField:function(){if(this.options.readonly!=true&&!this.element.hasClass("readonly")){var b=this;this.element.find("input.textInput").datepicker({format:b.options.textFormat,select:function(c){var c=a.youi.dateUtil.dateToStr(c,b.options.format),d=b.getValue();b.setValue(c);d!=c&&a.isFunction(window[b.options.id+"_change"])&&window[b.options.id+"_change"].apply(b.element[0],
[c])}})}},_fieldHtmls:function(){var a=[],c=this.options.width-11;a.push('<table cellpadding="0" cellspacing="0" width="'+c+'"><tbody><tr>');a.push('<td valign="top" width="'+(c-17)+'"><input style="width:'+(c-17-6)+'px;" type="text" class="textInput"></input><input type="hidden" class="value"></input></td>');a.push('<td class="youi-icon select-down" width="17px"></td>');a.push("</tr></tbody></table>");return a.join("")},_initAction:function(){this.element.find(".youi-icon.select-down").click(function(){a("input.textInput",
this.parentNode).datepicker("openDatepickerPanel")})},setValue:function(b){this.getValue();this.element.find("input.value").val(b);var c="";b&&b!=0&&(b=a.youi.dateUtil.strToDate(b,this.options.format),c=a.youi.dateUtil.dateToStr(b,this.options.textFormat));this.element.find("input.textInput").val(c)},getValue:function(){return this.element.find("input.value").val()},clear:function(){this.element.find("input.textInput,input.value").val("")},focus:function(){this.element.find("input.textInput").datepicker("openDatepickerPanel")},
setWidth:function(a){this.element.find("table").attr("width",a+"px").find("td:first").attr("width",a-15+"px");this.element.width(a).find(".textInput").width(a-15)}}))})(jQuery);(function(a){a.widget("youi.fieldCheckboxGroup",a.extend({},a.youi.field,a.youi.fieldSource,{_initField:function(){this._initSource();this._datasLoader()},_fieldHtmls:function(){var a=[];a.push('<div id="'+this._getDatasContextId()+'"></div>');this.element.html(a.join(""))},_parseRecord:function(a,c,d){a=[];a.push('<div class="checkbox-item"><input type="checkbox" value="'+c.code+'" name="property:'+d.property+'">'+c.show+"</input></div>");return a.join("")},_getDatasContextId:function(){return"content_"+
this.options.id},setValue:function(b){this.element.find("input:checkbox[value="+(a.isArray(b)?b:[b]).join("],input:checkbox[value=")+"]").attr("checked","checked")},getValue:function(){var a=[];this.element.find("input:checkbox[checked]").each(function(){a.push(this.value)});return a},getText:function(){return this.element.find("input:checkbox[checked]").parent().text()},clear:function(){this.element.find("input:checkbox[checked]").removeAttr("checked")}}));a.extend(a.youi.fieldCheckboxGroup,{defaults:a.extend({},
a.youi.fieldDefaults,{})})})(jQuery);(function(a){a.widget("youi.fieldCkeditor",a.extend({},a.youi.field,{_initField:function(){var a=this.element.parents(".youi-form.youi-dialog:first"),c=this.options.id+"_editor";this.ckeditorId=c;var d=this.options.readOnly;if(a.length)window.setTimeout(function(){a.form("open").dialog("closeOverlay").parents(".youi-dialog-container:first").hide();CKEDITOR.replace(c,{readOnly:d})},100);else try{CKEDITOR.replace(c,{readOnly:d})}catch(e){}},_fieldHtmls:function(){var a=[];a.push('<textarea id="'+this.options.id+
'_editor" style="width:'+(this.options.width-17)+'px;z-index:9999;" type="text" class="textInput value"></textarea>');a.push('<div class="field-invalid"></div>');return a.join("")},setValue:function(a){var c=CKEDITOR.instances[this.ckeditorId];window.setTimeout(function(){try{c&&c.setData(a)}catch(d){}},200)},getValue:function(){try{return CKEDITOR.instances[this.ckeditorId].getData()}catch(a){return""}},reset:function(){this.element.removeClass("validate-success").removeClass("validate-error").removeAttr("title");
try{var a=CKEDITOR.instances[this.ckeditorId];a&&a.setData(this.option.defaultValue||"")}catch(c){}},clear:function(){try{var a=CKEDITOR.instances[this.ckeditorId];a&&a.setData("")}catch(c){}},validate:function(){this.element.removeClass("validate-error").removeAttr("title");return!this._validateNotNull()?false:true},destory:function(){CKEDITOR.instances[this.ckeditorId].destroy();this.element.removeClass("youi-field").removeAttr("fieldType").removeAttr("property");a.Widget.prototype.destroy.apply(this,
arguments);this.ckeditorId=null}}));a.extend(a.youi.fieldCkeditor,{defaults:a.extend({},a.youi.fieldDefaults,{})})})(jQuery);(function(a){a.widget("youi.fieldComboBox",a.extend({},a.youi.field,a.youi.fieldPop,{_initField:function(){this._initSource()},_parseRecord:function(b,c,d){var b=[],e=c.code,c=c.show,f=["option-item"],h=d.selectedValue;if(h!=null)for(var g=[],g=a.isArray(h)?h:[h],h=0;h<g.length;h++)if(e==g[h]){f.push("selected");d.selectedTexts.push(c);break}b.push('<div value="'+e+'" class="'+f.join(" ")+'">');b.push('<img class="youi-icon" src="'+a.youi.serverConfig.contextPath+'/images/s.gif"></img>');b.push(c);
b.push("</div>");return b.join("")},_getDatasContextId:function(){return"datasContext-"+this.options.id},_popPanelHtmls:function(){var b=[];b.push('<div class="datas-context" id="'+this._getDatasContextId()+'"></div>');b.push('<div class="youi-buttons">');b.push(a.youi.buttonUtil.createButtons([{name:"selectAll",caption:"\u5168\u9009"},{name:"clearAll",caption:"\u6e05\u7a7a"},{name:"close",caption:"\u5173\u95ed"}]));b.push("</div>");return b.join("")},_initPanelAction:function(){this._getPopPanel().mousedown(function(a){a.stopPropagation()}).bind("click",
function(b){var c=a.youi.eventUtil.getEventClass(b),d=this.getAttribute("fieldId");switch(c){case "option-item":a(b.target).toggleClass("selected");var e=[];a(".selected",this).each(function(){e.push(this.getAttribute("value"))});a.youi.fieldUtil.execMethod(a("#"+d),"setValue",e);break;case "event-youi-button":return a(b.target).hasClass("selectAll")?(e=[],a(".option-item",this).addClass("selected").each(function(){e.push(this.getAttribute("value"))}),a.youi.fieldUtil.execMethod(a("#"+d),"setValue",
e)):a(b.target).hasClass("clearAll")?(a(".selected",this).removeClass("selected"),a.youi.fieldUtil.execMethod(a("#"+d),"clear")):a(b.target).hasClass("close")&&a.youi.fieldUtil.execMethod(a("#"+d),"_closePanel"),false}})},setValue:function(b){if(a.isArray(b))if(this.element.find("input.value").val(b.join()),this._isLoaded()){for(var c=this._getPopPanel(),d=[],e=0;e<b.length;e++)d.push(c.find(".option-item[value="+b[e]+"]").text());this.setText(d.join());this.element.find("input.textInput").attr("title",
"\u5171\u9009\u62e9\u3010"+d.length+"\u3011\u6761\u8bb0\u5f55\uff1a\n "+d.join("\n "));this._resetChildren()}else this._datasLoader()},getValue:function(){var a=this.element.find("input.value").val();a!=null&&(a=a.split(","));return a},clear:function(){this.element.find("input").val("").removeAttr("title")}}));a.extend(a.youi.fieldComboBox,{defaults:a.extend({},a.youi.fieldPopDefaults,{})})})(jQuery);(function(a){function b(a,b){for(var c=[],h=0;h<a.length;h++)if((a[h].value!="char2"||b==3||b==5)&&!(a[h].value=="empty"&&b!=6))c.push('<input class="mode" type="radio"'),h==0&&c.push(' checked="checked" '),c.push(' name="mode'),c.push(b),c.push('" value="'),c.push(a[h].value),c.push('">'),c.push(a[h].text),c.push("</input>");return c.join("")}function c(b){var c=[];b.find("input.mode-value").each(function(){c.push(a(this).val())});return c.join("")}a.widget("youi.fieldCron",a.extend({},a.youi.field,
{_initField:function(){this._initAction()},_fieldHtmls:function(){var a=[];a.push('<table width="'+this.options.width+'px" class="cronTable" cellpadding="1" cellspacing="1">');for(var c="\u79d2,\u5206,\u65f6,\u65e5\u671f,\u6708,\u661f\u671f,\u5e74".split(","),f=[{value:"char1",text:" * "},{value:"char2",text:" ? "},{value:"sect",text:"\u533a\u95f4"},{value:"addo",text:"\u589e\u91cf"},{value:"free",text:"\u81ea\u7531"},{value:"empty",text:"\u7a7a"}],h=[],g=0;g<7;g++){a.push("<tr>");a.push('<td class="label">'+
c[g]+":</td>");for(var i=0;i<f.length;i++)a.push('<td class="modePanel '+(i==0?"show ":"")+f[i].value+'">'+this["_"+f[i].value+"Html"]()+"</td>");a.push('<td class="modeSwitch">');a.push(b(f,g));a.push("</td>");a.push("</tr>");h.push('<td class="cronLabel cronLabel-'+g+'"> * </td>')}a.push("</table>");a.push('<div class="cron-expression"><table><tr><td>\u5468\u671f\u8868\u8fbe\u5f0f\uff1a</td>');a=a.concat(h);a.push("</tr></table><div>");a.push('<input type="hidden" class="value"/><div class="field-invalid"></div>');
return a.join("")},_char1Html:function(){return' *(\u6bcf\u4e00\u65f6\u523b) <input  class="mode-value" type="hidden" value="*"/>'},_char2Html:function(){return' ?(\u5360\u4f4d\u7b26)<input  class="mode-value" type="hidden" value="?"/>'},_sectHtml:function(){var a=[];a.push('<input class="mode-value" value="1" type="text" size="6"/>(\u8d77\u59cb)');a.push(' - <input class="mode-value" type="hidden" value="-"/>');a.push('<input class="mode-value" value="1" type="text" size="6"/>(\u7ed3\u675f)');return a.join("")},
_emptyHtml:function(){return""},_addoHtml:function(){var a=[];a.push('<input class="mode-value" value="1" type="text" size="6"/>(\u8d77\u59cb)');a.push(' / <input class="mode-value" type="hidden" value="/"/>');a.push('<input class="mode-value" value="1" type="text" size="6"/>(\u589e\u91cf)');return a.join("")},_freeHtml:function(){return'<input class="mode-value" type="text" size="15"/>'},_initAction:function(){this.element.delegate("input.mode","click",function(b){var e=a(this).val(),f=a(this).parents("tr:first");
a(".modePanel",f).not("."+e).removeClass("show");e=a(".modePanel."+e,f);e.addClass("show");f=f.prevAll().length;a(".cron-expression .cronLabel.cronLabel-"+f,b.livedFired).text(c(e))}).delegate("input.mode-value","change",function(b){var e=a(this).parents("tr:first"),f=a(this).parents("td.modePanel:first"),e=e.prevAll().length;a(".cron-expression .cronLabel.cronLabel-"+e,b.livedFired).text(c(f))})},setValue:function(b){this.element.find("input.mode[value=free]").click();var c=b.split(" ");this.element.find(".modePanel.free .mode-value").each(function(b){var d=
c[b]||"";a(this).val(d);a(".cron-expression .cronLabel.cronLabel-"+b,a(this).parents(".fieldCron:first")).text(d)})},getValue:function(){var b=[];this.element.find(".cron-expression .cronLabel").each(function(){var c=a(this).text();c&&b.push(c)});return b.join(" ")},clear:function(){this.element.find("input.mode[value=char1]").click();this.element.find(".cron-expression .cronLabel").text("*")},validate:function(){}}))})(jQuery);(function(a){a.widget("youi.fieldCustom",a.extend({},a.youi.field,{options:{},_initField:function(){if(this.isCustom())this.element[this.options.custom](a.extend({},this.options,this.options.customOptions,{initHtml:true}))},isCustom:function(){return this.options.custom&&this.element[this.options.custom]}}))})(jQuery);(function(a){a.widget("youi.fieldGrid",a.extend({},a.youi.field,{options:{parentsAlias:[]},_initField:function(){this.element.addClass("youi-field");this.options.mode=this.options.mode||"normal";if(this.options.gridId){var b=a("#"+this.options.gridId);b.parent()[0]!=this.element[0]&&this.element.empty().append(b)}this.options.width==0&&this.element.width("100%")},setValue:function(b){if(this.options.parents){for(var b=this.options.parents,c,d=[],e,f,h=0;h<b.length;h++)c=a.youi.fieldUtils.getRelElementByProperty(this.options.id,
b[h],this.options.prefix),e=this.options.parentsAlias[h]||b[h],c&&c.length&&(f=c.fieldValue()),e&&f&&d.push(a.youi.parameterUtils.propertyParameter(e,f));d.length?a("#"+this.options.gridId).grid("loadByParents",d):a("#"+this.options.gridId).grid("parseRecords",[])}else this.options.mode=="select"?a("#"+this.options.gridId).grid("setSelectedRecords",b):a("#"+this.options.gridId).grid("parseRecords",b)},getValue:function(){var b=a("#"+this.options.gridId);return this.options.mode=="select"?b.grid("getSelectedRecords"):
b.grid("getRecords")},clear:function(){var b=a("#"+this.options.gridId);if(this.options.mode=="select")b.find(".selected").removeClass("selected");else try{b.grid("parseRecords",[],0)}catch(c){}},validate:function(){if(!this._validateNotNull())return false},_initAction:function(){}}));a.extend(a.youi.fieldGrid,{defaults:a.extend({},a.youi.fieldDefaults,{escapeSpecial:true})})})(jQuery);(function(a){a.widget("youi.fieldHidden",a.extend({},a.youi.field,{_initField:function(){},_fieldHtmls:function(){var a=[];a.push('<input name="'+this.options.property+'" type="hidden" class="value"></input>');return a.join("")},setValue:function(a){this.element.find("input.value").val(a)},getValue:function(){return this.element.find("input.value").val()},clear:function(){this.getValue()!==this.options.defaultValue&&this.element.find("input.value").val("")}}));a.extend(a.youi.fieldLabel,{defaults:a.extend({},
a.youi.fieldDefaults,{})})})(jQuery);(function(a){a.widget("youi.fieldLabel",a.extend({},a.youi.field,{_initField:function(){},_fieldHtmls:function(){var a=[];a.push('<a href="'+(this.options.href||"#")+'" target="'+this.options.target+'" class="textShow"></a>');a.push('<input name="'+this.options.property+'" type="hidden" class="value"></input>');return a.join("")},_initAction:function(){this.element.find("a.textShow").click(function(){a(this.parentNode).fieldLabel("goHref");a.support.boxModel&&this.blur()})},goHref:function(){var b=
this.element.find("a.textShow").attr("href"),c=this.options.params;if(a.isArray(c)&&c.length>0){for(var d=[],e,f,h=0;h<c.length;h++)e=c[h],f=a.youi.fieldUtil.getElementByProperty(e,this.options.prefix).fieldValue(),f!=null&&d.push(a.youi.parameterUtil.propertyParameter(e,f));b+=b.indexOf("?")==-1?"?":"&";b+=d.join("&")}this.element.find("a.textShow")[0].href=b},setValue:function(b){var c=b;this.options.convert&&a.youi.serverConfig.convertArray[this.options.convert]&&(c=a.youi.serverConfig.convertArray[this.options.convert][b],
this.options.mixed&&(c=b+" - "+c));this.element.find(".textShow").text(c||b);this.element.find("input.value").val(b)},getValue:function(){return this.element.find("input.value").val()},clear:function(){this.element.find(".textShow").text("");this.element.find("input.value").val("")}}));a.extend(a.youi.fieldLabel,{defaults:a.extend({},a.youi.fieldDefaults,{target:"_self"})})})(jQuery);(function(a){function b(a,b){for(var c=0;c<a.length;c++)if(a[c].id==b)return a[c];return null}var c=a.youi.log;a.widget("youi.fieldLayout",{options:{initHtml:true,columns:2},fields:[],_create:function(){this.fields=[];this._initFieldModels();this._defaultHtmls();this._initAction();this._initFields();this._autoAlign()},_initFieldModels:function(){if(this.options.fields&&this.options.fields.length){var b=this.options.fields,c=[],f=this.options.prefix;a(b).each(function(h){for(var g=a.youi.fieldUtils.getFieldId(this.property,
f),i="",k="",j=h-1;b[j];){if(b[j].type!="fieldHidden"){i=a.youi.fieldUtils.getFieldId(b[j].property,f);break}j--}for(h+=1;b[h];){if(b[h].type!="fieldHidden"){k=a.youi.fieldUtils.getFieldId(b[h].property,f);break}h++}if(this.parentProperties&&this.parentProperties.length){var m=[];a(this.parentProperties).each(function(){m.push(a.youi.fieldUtils.getFieldId(this))});this.parentIds=m}c.push(a.extend({id:g,type:"fieldText",column:1,nextField:k,prevField:i,prefix:f},this))});this.fields=c}},_defaultHtmls:function(){if(this.options.initHtml){var b=
a.youi.flcFactory.getContent("simple",this.fields,{columns:this.options.columns,showBorder:this.options.showBorder});this.element.addClass("youi-fieldLayout").html(b)}},_initAction:function(){a("body",document).bind("body.resize",{ui:this.element},function(a){try{a.data.ui.fieldLayout("resize")}catch(b){}})},_initFields:function(){var c=this.fields;this.element.find(".youi-field").each(function(){var e=this.getAttribute("id");if((e=b(c,e))&&a.youi[e.type])a(this)[e.type](e)})},validate:function(){this.element.find(".youi-field").fieldValidate();
return this.element.find(".youi-field.validating,.youi-field.validate-error").length==0?true:false},getFieldValues:function(){var c=[],e=this.fields;this.element.find(".youi-field").each(function(){var f=this.getAttribute("id"),f=b(e,f),h;a(this).hasClass("fieldCustom")&&(f={property:this.getAttribute("property")});if(f)h=a(this).fieldValue(),property=f.property,typeof h=="string"?c.push({property:property,value:h}):h&&h.length&&a(h).each(function(){c.push({property:property,value:this})})});return c},
getRecord:function(){var b={};this.element.find(".youi-field").each(function(){var c=this.getAttribute("property"),f;c&&(f=a(this).fieldValue())&&(b[c]=f)});return b},getFieldParamters:function(){var c=[],e=this.fields;this.element.find(".youi-field").each(function(){var f=this.getAttribute("id"),f=b(e,f),h;a(this).hasClass("fieldCustom")&&(f={property:this.getAttribute("property")});if(f)h=a(this).fieldValue(),property=f.property,typeof h=="string"?c.push(a.youi.parameterUtils.propertyParameter(property,
h)):h&&h.length&&a(h).each(function(){c.push(a.youi.parameterUtils.propertyParameter(property,h))})});return c},setFieldValues:function(b){this.element.find(".youi-field").each(function(){var e=this.getAttribute("property"),f=a("input.textInput",this).attr("showProperty"),e=a.youi.recordUtils.getPropertyValue(b,e),f=a.youi.recordUtils.getPropertyValue(b,f);if(e!=null&&!e.length==0)try{a(this).fieldValue(e,f?f:e)}catch(h){c.info("\u8bbe\u7f6e\u503c\u5f02\u5e38\uff1a"+h)}})},fieldDefaultValue:function(a,
b){var c=this.element.find('.youi-field[property="'+a+'"]');c.fieldDefaultValue(b);c.fieldReset()},reset:function(){this.element.find(".youi-field").fieldReset()},resize:function(){this.element.is(":visible")&&this._autoAlign()},_autoAlign:function(){this.element.is(":visible")&&this.element.find(".youi-field.autoAlign").each(function(){var b=a(this).parent().width();a(this).width(b-5);a("input.textInput",this).width(b-20)})},destroy:function(){a.Widget.prototype.destroy.apply(this)}});a.extend(a.youi.fieldLayout,
{getter:["getFieldValues","getFieldParamters"]});a.youi.flcFactory={getContent:function(b,c,f){switch(b){default:return a.youi.flcFactory.getSimpleContent(c,f)}},getSimpleContent:function(b,c){var f=[],h=0,g=0,i=[],k=c.columns*2,j=0;a(b).each(function(){if(this.type=="fieldHidden")f.push('<div fieldType="fieldHidden" class="youi-field fieldHidden" id="'+this.id+'"></div>');else{var a=Math.min(this.column*2,k),b=a-1;j+=a;g+=a;if(g>k){for(var c=k-(g-a),d=0;d<c;d++)i[h].push("<td></td>");j+=c;g=a}h=
Math.ceil(j/k)-1;i[h]||(i[h]=[],g=a);i[h].push('<td class="field-label '+(this.notNull?"notNull":"")+'"><label for="'+this.type+"-"+this.id+'">'+this.caption+"\uff1a</label></td>");i[h].push("<td");b>1&&i[h].push(' colspan="'+b+'" ');i[h].push('><div id="'+this.id+'" class="youi-field" fieldType="'+this.type+'"></div></td>');fieldOption=null}});var m=i.length;if(j<k*m)for(var l=0;l<k*m-j;l++)i[m-1].push("<td></td>");f.push("<table"+(c.showBorder?' class="showBorder"  border="1"':"")+' width="100%">');
f.push("<tr>");for(l=0;l<k;l++)f.push('<td class="contral" style="'+(l%2==0?"width:80px;":"")+'"></td>');f.push("</tr>");a(i).each(function(){f.push("<tr>");f=f.concat(this);f.push("</tr>")});f.push("</table>");return f.join("")}}})(jQuery);(function(a){a.widget("youi.fieldPassword",a.extend({},a.youi.field,{_initField:function(){},_fieldHtmls:function(){var a=[];a.push('<input style="width:'+(this.options.width-17)+'px;" type="password" class="textInput value"></input>');a.push('<div class="field-invalid"></div>');return a.join("")},setValue:function(a){this.element.find("input.value").val(a)},getValue:function(){return this.element.find("input.value").val()},reset:function(){this.element.find("input.value").val(this.options.defaultValue||
"")},clear:function(){this.element.find("input.value").val("")}}));a.extend(a.youi.fieldPassword,{defaults:a.extend({},a.youi.fieldDefaults,{})})})(jQuery);(function(a){a.widget("youi.fieldRadioGroup",a.extend({},a.youi.field,a.youi.fieldSource,{_initField:function(){this._initSource();this._datasLoader()},_fieldHtmls:function(){},_initAction:function(){var b=this.widgetFullName;this.element.delegate("input:radio","click",function(c){a.data(c.delegateTarget,b)._valueChange(this.value);return true})},_valueChange:function(b){if(b!=this.oldValue)b=this.options.change,a.isFunction(b)||(b=window[this.options.id+"_change"]),a.isFunction(b)&&b.apply(this.element[0],
[this.getValue()]),this.oldValue=null},_parseRecord:function(a,c,d){a=[];a.push('<input type="radio" '+(d.selectedValue==c.code?' checked="checked" ':"")+' value="'+c.code+'" name="property:'+d.property+'">'+c.show+"</input>");return a.join("")},_getDatasContextId:function(){return"content_"+this.options.id},setValue:function(a){this.oldValue=this.getValue();this.element.find("input:radio[value="+a+"]").attr("checked","checked");this._valueChange(a)},getValue:function(){return this.element.find("input:radio[checked]").val()},
clear:function(){this.element.find("input:radio[checked]").removeAttr("checked")}}));a.extend(a.youi.fieldRadioGroup,{defaults:a.extend({},a.youi.fieldDefaults,{})})})(jQuery);(function(a){a.widget("youi.fieldSelect",a.extend({},a.youi.field,a.youi.fieldPop,{_initField:function(){this._initSource()},_parseRecord:function(b,c,d){var b=[],e=c.code,c=d.mixed?c.show+"("+e+")":c.show,f=["option-item"],h=d.selectedValue;if(h!=null)for(var g=[],g=a.isArray(h)?h:[h],h=0;h<g.length;h++)if(e==g[h]){f.push("selected");d.selectedTexts.push(c);break}b.push('<div value="'+e+'" class="'+f.join(" ")+'">'+c+"</div>");return b.join("")},_nullItemHtml:function(){return'<div class="option-item"></div>'},
_getDatasContextId:function(){return this._getPanelId()},_initPanelAction:function(){this._getPopPanel().mousedown(function(a){a.stopPropagation()}).bind("click",function(b){if(a.youi.classUtils.getEventClass(b)=="option-item"){var c=this.getAttribute("fieldId"),b=b.target.getAttribute("value")||"";a.youi.fieldUtils.execMethod(a("#"+c),"setValue",b);a.youi.fieldUtils.execMethod(a("#"+c),"_closePanel")}})},setValue:function(a){var c=this.getValue();this.element.find("input.value").val(a);this._isLoaded()?
(this.setText(this._getPopPanel().find(".option-item[value="+a+"]").text()),this._resetChildren()):this._datasLoader();this._valueChange(c,a)},_valueChange:function(b,c){if(b!=c){if(a.isFunction(window[this.options.id+"_change"]))window[this.options.id+"_change"](c,b);a.isFunction(this.options.change)&&this.options.change(c,b)}a.isFunction(this.options.afterSetValue)&&this.options.afterSetValue(c)},setWidth:function(a){a+=5;this.element.find("table").attr("width",a+"px").find("td:first").attr("width",
a-21+"px");this._getPopPanel().width(a-1);this.element.width(a).find(".textInput").width(a-21)},getValue:function(){return this.element.find("input.value").val()},focus:function(){this._openPanel();this.element.find("input.textInput").focus()}}));a.extend(a.youi.fieldSelect,{defaults:a.extend({},a.youi.fieldPopDefaults,{})})})(jQuery);(function(a){a.widget("youi.fieldSwfupload",a.extend({},a.youi.field,{options:a.extend({},a.youi.field.options,{buttonWidth:60,buttonHeight:22}),_initField:function(){new SWFUpload({upload_url:this.options.uploadUrl,flash_url:this.options.flashUrl,button_placeholder_id:this._buildSwfuploadId(),button_text:this.options.buttonCaption,button_width:this.options.buttonWidth,button_height:this.options.buttonHeight,button_image_url:a.youi.serverConfig.contextPath+"styles/images/button/swfbutton.png",file_types:this.options.fileTypes,
file_types_description:this.options.fileTypesDescription,file_size_limit:this.options.fileSizeLimit,file_upload_limit:this.options.fileUploadLimit,file_queue_limit:this.options.fileQueueLimit,custom_settings:{fieldElement:this.element},file_queued_handler:function(){},file_queue_error_handler:function(a,c,d){a="";switch(c){case -100:a="\u4e00\u6b21\u6700\u591a\u5141\u8bb8\u9009\u62e9"+d+"\u4e2a\u6587\u4ef6\uff01";break;case -110:a="ERROR_CODE_FILE_EXCEEDS_SIZE_LIMIT";break;case -120:a="\u9519\u8bef\u7684\u6587\u4ef6\uff01";
break;case -130:a="\u9519\u8bef\u7684\u6587\u4ef6\u7c7b\u578b\uff01";break;default:a="\u672a\u77e5\u9519\u8bef\uff01"}alert(a)},file_dialog_complete_handler:function(){this.getStats().files_queued>0&&(this.startUpload(),this.setButtonDisabled(true))},upload_start_handler:function(){},upload_progress_handler:function(b,c,d){var e=this,c=Math.ceil(c/d*100),f=this.customSettings.fieldElement,h=b.id,g=b.name,b=a("#"+h,f);b.length==0&&(b=a('<div id="'+h+'"></div>').appendTo(f.find(">.field-swfupload-files")),
b.progressbar({change:function(c,b){a(".percentage",this).length==0&&a(".ui-progressbar-value",this).after('<div><span id="'+g+'" class="value">'+g+'</span>(<span class="percentage">'+b.percentage+'</span>%)<span title="\u53d6\u6d88\u4e0a\u4f20" class="youi-icon close"></span><input type="hidden" class="filePath"/></div>');a(".percentage",this).html("\u4e0a\u4f20\u8fdb\u5ea6\uff1a"+Math.ceil(d*b.percentage/1024/1024)/100+"M/"+Math.ceil(d*100/1024/1024)/100+"M,"+b.percentage)}}),b.delegate(".close",
"click",function(){var c=a(this).parent().parent(),b=c.attr("id");e.cancelUpload(b);c.remove()}));b.progressbar("value",c)},upload_error_handler:function(a,c){alert(c)},upload_success_handler:function(b,c){var d;d=typeof c=="string"?a.parseJSON(c):c;var e=this.customSettings.fieldElement;d&&d.filePath?e.find("#"+b.id+" input.filePath").val(d.filePath):e.find("#"+b.id).remove()},upload_complete_handler:function(){try{this.getStats().files_queued>0?this.startUpload():this.setButtonDisabled(false)}catch(a){this.debug(a),
this.setButtonDisabled(false)}},debug:this.options.debug})},_buildSwfuploadId:function(){return this.options.id+"_swfupload"},_fieldHtmls:function(){var a=[];a.push('<div class="field-swfupload-files"></div>');a.push('<div style="field-swfupload-btn"><div id="'+this._buildSwfuploadId()+'"></div></div>');return a.join("")},setValue:function(){this.clear()},getValue:function(){var b=[];this.element.find("input.filePath").each(function(){b.push(a(this).val())});return b},reset:function(){this.clear()},
clear:function(){this.element.find(">.field-swfupload-files").empty()},validate:function(){return true}}))})(jQuery);(function(a){var b=a.youi.log;a.widget("youi.fieldText",a.extend({},a.youi.field,{_initField:function(){},_fieldHtmls:function(){var a=[];a.push('<input style="width:'+(this.options.width-6)+'px;" type="text" class="textInput value"></input>');a.push('<div class="field-invalid"></div>');return a.join("")},setValue:function(a){this.element.find("input.value").val(a)},getValue:function(){return this.element.find("input.value").val()},clear:function(){this.element.removeClass("validate-success").removeClass("validate-error").removeAttr("title");
this.element.find("input.value").val("")},focus:function(){this.element.find("input.value").focus()},validate:function(){this.element.removeClass("validate-error").removeAttr("title");if(!this._validateNotNull())return false;var c,b="",e=this.options.fractionLength||0;if(this.options.expression)c=this.options.expression,b=this.options.expressionMessage;else switch(this.options.dataType){case "integer":c=this.regexps.integer;b="\u8bf7\u8f93\u5165\u6574\u6570\u7c7b\u578b\u503c";break;case "number":c=
this.regexps.number(e);b="\u8bf7\u8f93\u5165\u6570\u503c\u7c7b\u578b\u503c\uff0c\u6700\u5927\u5c0f\u6570\u70b9\u4f4d\u6570\u4e3a"+e;break;case "text":c=this.regexps.text;b="\u8bf7\u8f93\u5165\u7531\u6570\u5b57\u300126\u4e2a\u82f1\u6587\u5b57\u6bcd\u6216\u8005\u4e0b\u5212\u7ebf\u7ec4\u6210\u7684\u5b57\u7b26\u4e32";break;case "email":b="\u8bf7\u8f93\u5165\u90ae\u4ef6\u683c\u5f0f\u4e32";c=this.regexps.email;break;case "phone":b="\u8bf7\u8f93\u5165\u7535\u8bdd\u53f7\u7801";c=this.regexps.phone;break;
case "url":b='\u8bf7\u8f93\u5165URL\uff0c\u4ee5"http://"\u5f00\u5934',c=this.regexps.url}e=a.trim(this.getValue());if(this.options.escapeSpecial&&this._exsitSpecial(e))return this._validateError("\u542b\u6709\u7279\u6b8a\u5b57\u7b26\uff01"),false;if(e&&this.options.maxLength&&e.length>this.options.maxLength)return b="\u6700\u5927\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7"+this.options.maxLength,this._validateError(b),false;if(e&&this.options.minLength&&e.length<this.options.minLength)return b="\u6700\u5c0f\u957f\u5ea6\u4e0d\u80fd\u5c0f\u4e8e"+
this.options.minLength,this._validateError(b),false;return!c||!e?true:RegExp(c).test(e)?(this._validateSuccess(),true):(this._validateError(b),false)},_exsitSpecial:function(a){return!/^[^\|"'<>]*$/.test(a)},ajaxValidate:function(){if(this.options.validateSrc){var c=this.getValue();if(!(c==null||c=="")){this.element.addClass("validating");b.info("validateSrc:"+this.options.validateSrc);var d=this.options.validateSrc;d+=d.indexOf("?")==-1?"?":"&";d+=a.youi.parameterUtil.propertyParameter(this.options.property,
c);a.youi.ajaxUtil.ajax({url:d,element:this.element,success:function(a){a.message&&a.message.passed==false?this.element.removeClass("validate-success").addClass("validate-error").attr("title",a.message.info):this.element.addClass("validate-success");this.element.removeClass("validating")},error:function(){b.error("\u6821\u9a8c\u5730\u5740\u3010"+this.url+"\u3011\u9519\u8bef:\u5730\u5740\u65e0\u6cd5\u8bbf\u95ee\uff01");this.element.removeClass("validating")}})}}},regexps:{integer:"^-?[1-9]\\d*$",number:function(a){var b=
"^-?([1-9]\\d*\\.\\d*|0\\.\\d*[1-9]\\d*|0?\\.0+|0)$";a&&(b="^-?(0|[1-9]*)+(\\.[0-9]{1,"+a+"})?$");return b},text:"^\\w+$",email:"\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*",phone:"\\d{3}-\\d{8}|\\d{4}-\\d{7}",url:"[a-zA-z]+://[^\\s]*"},_initAction:function(){this.element.find("input.value").bind("change",function(){a(this).parents(".fieldText")}).bind("keypress",function(){a(this).parents(".fieldText").removeClass("validate-error").removeClass("validate-success")})}}));a.extend(a.youi.fieldText,
{defaults:a.extend({},a.youi.fieldDefaults,{escapeSpecial:true})})})(jQuery);(function(a){a.widget("youi.fieldArea",a.extend({},a.youi.field,{_initField:function(){},_fieldHtmls:function(){var a=[];a.push('<textarea style="width:'+(this.options.width-17)+'px;" type="text" class="textInput value"></textarea>');a.push('<div class="field-invalid"></div>');return a.join("")},setValue:function(a){this.element.find("textarea.value").val(a)},getValue:function(){return this.element.find("textarea.value").val()},clear:function(){this.element.removeClass("validate-success").removeClass("validate-error").removeAttr("title");
this.element.find("textarea.value").val("")},validate:function(){this.element.removeClass("validate-error").removeAttr("title");if(!this._validateNotNull())return false;var b=a.trim(this.getValue());if(b&&this.options.maxLength&&b.length>this.options.maxLength)return regMessage="\u6700\u5927\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7"+this.options.maxLength,this._validateError(regMessage),false;if(b&&this.options.minLength&&b.length<this.options.minLength)return regMessage="\u6700\u5c0f\u957f\u5ea6\u4e0d\u80fd\u5c0f\u4e8e"+
this.options.minLength,this._validateError(regMessage),false}}));a.extend(a.youi.fieldArea,{defaults:a.extend({},a.youi.fieldDefaults,{})})})(jQuery);(function(a){a.widget("youi.fieldTree",a.extend({},a.youi.field,a.youi.fieldPop,{_initField:function(){this._initSource();var b=this.options.onlyLeaf,c=this.options.check;if(this.options.simple==true)this._getPopPanel().mousedown(function(c){c.stopPropagation();if(a.youi.classUtils.getEventClass(c)=="option-item"){c=a(c.target);if(b){var d=c.next();if(d.length){var g=c.html().split("&nbsp;").length,d=d.html().split("&nbsp;").length;if(g<d)return}}g=a(this).attr("fieldId");a("#"+g).fieldValue(c.attr("id"),
a.trim(c.text()));a(".selected",this).removeClass("selected");c.addClass("selected")}}).dblclick(function(c){if(a.youi.classUtils.getEventClass(c)=="option-item"){var d=a(c.target);if(b&&(c=d.next(),c.length&&(d=d.html().split("&nbsp;").length,c=c.html().split("&nbsp;").length,d<c)))return;c=a(this).attr("fieldId");a.youi.fieldUtils.execMethod(a("#"+c),"_closePanel")}return false});else{var d=this._getPopPanel().mousedown(function(a){a.stopPropagation()}),e=d.find("#field_tree_"+this.options.id);
e.length==0&&(e=[],e.push('<div  style="height:300px;" class="field-tree-container">'),e.push('<div style="width:600px;" id="field_tree_'+this.options.id+'">'),e.push("</div>"),e.push("</div>"),d.append(e.join("")),e=d.find("#field_tree_"+this.options.id));e.tree({iteratorSrc:this.options.iteratorParentAttr?this.options.src:"",root:this.options.caption,idAttr:this.options.code,textAttr:this.options.show,iteratorParentAttr:this.options.iteratorParentAttr,autoLoad:false,check:this.options.check,select:function(d){if(!b||
!a(this).hasClass("expandable")){var e=a(this).parents(".field-tree-panel:first").attr("fieldId");if(!a(this).hasClass("root")){var g=[],i=[];c?a("li.checked,li.partchecked",d).not(".root").each(function(){g.push(this.getAttribute("id"));i.push(a(">span",this).text())}):(g.push(this.getAttribute("id")),i.push(a(">span",this).text()));a("#"+e).fieldValue(g,i)}}},dblclick:function(){if(!b||!a(this).hasClass("expandable")){var c=a(this).parents(".field-tree-panel:first").attr("fieldId");a.youi.fieldUtils.execMethod(a("#"+
c),"_closePanel")}}})}d=a.extend({clear:function(){var c=a(this).parents(".field-tree-panel:first").attr("fieldId");a.youi.fieldUtils.execMethod(a("#"+c),"clear")},close:function(){var c=a(this).parents(".field-tree-panel:first").attr("fieldId");a.youi.fieldUtils.execMethod(a("#"+c),"_closePanel")}},this.options.buttonActions);this.options.notNull&&(d.clear=null);a.youi.buttonUtils.addButtonActionListener(this._getPopPanel().find(".fieldTree-buttons"),d)},_parseRecord:function(){return""},_nullItemHtml:function(){return'<div class="option-item">\u8bf7\u9009\u62e9...</div>'},
_getDatasContextId:function(){return this.options.popup?this._getPanelId():"content_"+this.options.id},_initPanelAction:function(){},_openPanel:function(){var b=this._getPopPanel();b.find("#field_tree_"+this.options.id).tree("loadIteratorRoot");this._setPanelPosition();b.addClass("expanded");a.youi.popUtils.showPopBackground(1200)},setValue:function(b,c){var d=this.getValue(),e=[],f=[],e=a.isArray(b)?b:b.split(",");if(c==null&&b)if(this.options.simple==true){var h=this._getPopPanel().find("#field_tree_"+
this.options.id+" #"+b.replace(/(:|\.)/g,"\\$1"));a.trim(h.text())}else if(this.options.check&&e.length){if(this.options.valueMode==="object"&&this.options.code){for(var h=[],g=0;g<e.length;g++)h.push(e[g][this.options.code]);e=h}this._getPopPanel().find("#field_tree_"+this.options.id).tree("checkedTreeNodes",e)}else(h=this._getPopPanel().find("#field_tree_"+this.options.id)[0].ownerDocument.getElementById(b))&&a(">span",h).text();else a.isArray(c)?f=c:f.push(c);this.element.find("input.value").val(e.join());
this.element.find("input.textInput").val(f.join());d!=b&&this._resetChildren()},_valueChange:function(b,c){if(b!=c&&a.isFunction(window[this.options.id+"_change"]))window[this.options.id+"_change"](c,b)},_validateNotNull:function(){if(this.options.notNull==null)return true;var b=this.getValue();if(this.options.notNull==true){if(a.isArray(b)&&b.length>0)return true;if(typeof b=="string"&&b!=""&&b!=null)return true}this._validateError("\u4e0d\u80fd\u4e3a\u7a7a");return false},validate:function(){this.element.removeClass("validate-error").removeAttr("title");
return!this._validateNotNull()?false:true},getValue:function(){var a=this.element.find("input.value").val();if(!a)return null;a=a.split(",");if(this.options.code&&this.options.valueMode==="object"){for(var c=[],d=0;d<a.length;d++){var e={};e[this.options.code]=a[d];c.push(e)}return this.options.check?c:c[0]}else return this.options.check?a:a[0]},clear:function(){this.element.find("input.textInput,input.value").val("");this.options.check?this._getPopPanel().find("#field_tree_"+this.options.id).tree("clearCheckedTreeNodes"):
this._getPopPanel().find("#field_tree_"+this.options.id+" .selected").removeClass("selected")}}));a.extend(a.youi.fieldTree,{defaults:a.extend({},a.youi.fieldPopDefaults,{popup:true})})})(jQuery);(function(a){a.widget("youi.accordion",a.extend({_init:function(){this.element.addClass("youi-accordion");this.childCount=this.element.find(">div").length;this._initAction();this.active(0)},active:function(a){var c=this.element.find(".youi-accordion-header:eq("+a+")");if(!c.hasClass("youi-state-active")){var d=this.childCount*30+3,e="auto";this.options.height&&(e=this.options.height-d+"px");this.element.find(".youi-accordion-content-active").removeClass("youi-accordion-content-active");this.element.find(".youi-accordion-header.youi-state-active").removeClass("youi-state-active");
c.addClass("youi-state-active");this.element.find(".youi-accordion-content:eq("+a+")").addClass("youi-accordion-content-active").css("height",e)}},_initAction:function(){this.element.delegate(".youi-accordion-header","click",function(b){var c=a(this).parent().prevAll().length;a(b.delegateTarget).accordion("active",c);return false})},_defaultHtmls:function(){this.element.append("")}}));a.extend(a.youi.accordion,{version:"1.0.0",defaults:{}})})(jQuery);(function(a){function b(a){this.value="";this.pos=0;this.string=a;this.len=a.length;this.fmts="yyyy,yy,y,MMMM,MMM,NNN,MM,M,dd,d,EEEE,EE,E,hh,h,HH,H,KK,K,kk,k,mm,m,ss,s,a".split(",");this.parse_string=function(a,c){for(var b=0;b<a.length;++b){var h=a[b].length,g=c?a[b]:a[b].toLowerCase();if(this.len>=this.pos+h&&(c?this.string.substr(this.pos,h):this.string.substr(this.pos,h).toLowerCase())==g)return this.value=this.string.substr(this.pos,h),this.pos+=h,b}return-1};this.parse_char=function(){return this.len>=
this.pos+1?(this.value=this.string.substr(this.pos,1),this.pos+=1,0):-1};this.parse_space=function(){for(;this.string.charAt(this.pos)==" "||this.string.charAt(this.pos)=="\t";)++this.pos;return 0};this.parse_number=function(a,c,b){if(this.len>=this.pos+a){for(var h=0;h<a;++h)if(parseInt(this.string.charAt(this.pos+h),10)!=this.string.charAt(this.pos+h))return-1;this.value=this.string.substr(this.pos,a);h=parseInt(this.value,10);if(h>=c&&h<=b)return this.pos+=a,h}return-1};this.parse_format=function(){return this.parse_string(this.fmts,
true)==-1?this.parse_char():0}}a.youi.dateUtil={dateToStr:function(a,b){return!a?"":"millis"==b?a.getTime():a.igFormat(b)},strToDate:function(a,b){if(b==null||a==null)throw"Invalid arguments";var e=new Date;if("millis"==b)e.setTime(a);else return e.igParse(b,a);return e}};a.widget("youi.datepicker",{options:{format:"yyyy-MM-dd",showIcon:false},_create:function(){this.element.addClass("youi-datepicker");this.options.showIcon&&a('<a href="#" class="youi-datepicker-icon"></a>').insertAfter(this.element).bind("click",
function(){a(this).prev().datepicker("openDatepickerPanel")}).bind("mousedown",function(a){a.stopPropagation()});this._initAction()},_initAction:function(){var c=this;a(document).bind("mousedown.datepicker",function(){c.closeDatepickerPanel()});this.element.bind("click",function(){a(this).datepicker("openDatepickerPanel")}).bind("mousedown",function(a){a.stopPropagation()})},openDatepickerPanel:function(){var c=this.element.val(),c=a.youi.dateUtil.strToDate(c,this.options.format),b=this.element.offset().left,
e=this.element.offset().top+this.element.outerHeight();this._getDatepickerPanel().datepickerPanel("open",c,this.element).css({left:b,top:e})},closeDatepickerPanel:function(){this._getDatepickerPanel().datepickerPanel("close")},_getDatepickerPanel:function(){var c=a("#youi-datepicker-panel");c.length==0&&(c=a('<div class="datepicker-pop datepicker-hide" id="youi-datepicker-panel"></div>').appendTo(a("body",document)));c.datepickerPanel({bind:this.element,format:this.options.format,onSelect:this.options.select});
return c}});a.extend(a.youi.datepicker,{version:"1.0.0",defaults:{format:"yyyy-MM-dd",showIcon:false}});a.widget("youi.datepickerPanel",{options:{format:"yyyy-MM-dd"},currentDate:null,_create:function(){this.element.addClass("youi-datepicker-panel");this.currentDate=new Date;this.selectedDate=new Date;this._defaultHtmls();this._initAction();this._autoRefreshTime()},_autoRefreshTime:function(){var c=this;this.options.autoRefresh&&window.setTimeout(function(){var b=new Date;a("input.datepicker-time.HH",
c.element).val(b.getHours());a("input.datepicker-time.MI",c.element).val(b.getMinutes());a("input.datepicker-time.SS",c.element).val(b.getSeconds());c._autoRefreshTime()},1E3)},_defaultHtmls:function(){var a=new Date,b=a.getFullYear(),a=a.getMonth(),e=[];e.push('<div class="datepicker-header"><table width="100%" cellpadding="0" cellspacing="0"><tr><td><a class="listener-prevYear" href="#" title="\u4e0a\u4e00\u5e74"><<</a><a class="listener-prevMonth" href="#" title="\u4e0a\u4e00\u6708"><</a></td><td align="center" class="datepicker-dateInfo">'+
this._getYearMonthStr(b,a)+'</td><td align="right"><a href="#" class="listener-nextMonth" title="\u4e0b\u4e00\u6708">></a><a href="#" class="listener-nextYear" title="\u4e0b\u4e00\u5e74">>></a></td></tr></table></div>');e.push('<div class="datepicker-content">');e.push(this._generateContentHtml(b,a));e.push("</div>");e.push('<div class="datepicker-footer">');e.push('<table width="100%" cellpadding="0" cellspacing="0" height="22px"><tr><td><input type="text" size="2"  class="datepicker-time HH">\u65f6</input></td><td><input type="text" size="2" class="datepicker-time MI">\u5206</input></td><td><input type="text" size="2"  class="datepicker-time SS">\u79d2</input></td><td  valign="bottom" style="padding-bottom:2px;"><a href="#" class="listener-today aButton">\u4eca\u5929</a><a href="#" class="listener-clear aButton">\u6e05\u9664</a></td><td></td></tr></table>');
e.push("</div>");this.element.html(e.join(""))},_initAction:function(){this.element.bind("click",function(c){var b=c.target.className;b&&(b=b.split(" ")[0]);switch(b){case "listener-prevMonth":a(this).datepickerPanel("prevMonth");break;case "listener-nextMonth":a(this).datepickerPanel("nextMonth");break;case "listener-prevYear":a(this).datepickerPanel("prevYear");break;case "listener-nextYear":a(this).datepickerPanel("nextYear");break;case "datapicker-days":a(this).datepickerPanel("selectDate",a(c.target).text());
break;case "listener-today":c=new Date;a(this).datepickerPanel("goDate",c.getFullYear(),c.getMonth()).datepickerPanel("selectDate",c);break;case "listener-clear":a(this).datepickerPanel("clear")}return false}).bind("mousedown",function(a){a.stopPropagation()});this.element.delegate(".datepicker-time","keydown",function(c){if(c.keyCode=="13"){var c=a(c.liveFired),b=a(".datepicker-time.yyyy",c).val(),e=a(".datepicker-time.MM",c).val();c.datepickerPanel("goDate",b,parseInt(e)-1,1)}})},_generateContentHtml:function(a,
b){var e=this._getDaysInMonth(a,b),f=this._getFirstDayOfMonth(a,b),f=f==7?"-1":f,h,g=['<table width="100%" border="0" cellpadding="0" cellspacing="1"><tbody>'];g.push("<tr><th>\u65e5</th><th>\u4e00</th><th>\u4e8c</th><th>\u4e09</th><th>\u56db</th><th>\u4e94</th><th>\u516d</th></tr>");g.push("<tr>");for(var i,k=0;k<7;k++)i=k-f+1,g.push("<td>"),k>=f&&(g.push('<a id="'+i+'" class="'+this._getDateTdClass(a,b,i,e)+'">'+i+"</a>"),k==6&&(h=i)),g.push("</td>");g.push("</tr>");f=Math.ceil((e-h)/7);for(k=0;k<
f;k++){g.push("<tr>");for(i=0;i<7;i++)g.push("<td>"),++h<=e&&g.push('<a id="'+h+'" class="'+this._getDateTdClass(a,b,h,e)+'">'+h+"</a>"),g.push("</td>");g.push("</tr>")}g.push("</tbody></table>");return g.join("")},_getFirstDayOfMonth:function(a,b){return(new Date(a,b,1)).getDay()},_getDaysInMonth:function(a,b){return 32-(new Date(a,b,32)).getDate()},_getYearMonthStr:function(a,b){return'<input value="'+a+'" style="width:36px;" class="datepicker-time yyyy"></input>\u5e74<input value="'+(b+1)+'" class="datepicker-time MM"></input>\u6708'},
_getDateTdClass:function(a,b,e,f){var h=[];e>0&&e<=f&&h.push("datapicker-days");var f=this.selectedDate.getFullYear(),g=this.selectedDate.getMonth(),i=this.selectedDate.getDate();f==a&&g==b&&e==i&&h.push("selected");e<10&&h.push("small");f=new Date;f.getFullYear()==a&&f.getMonth()==b&&e==f.getDate()&&h.push("today");return h.join(" ")},_selectDate:function(b){if(typeof b=="object"&&b.getTime())this.currentDate=b,b=b.getDate();var d=this.currentDate.getFullYear(),e=this.currentDate.getMonth(),d=new Date(d,
e,b),e=a("input.datepicker-time.HH",this.element).val(),f=a("input.datepicker-time.MI",this.element).val(),h=a("input.datepicker-time.SS",this.element).val();isNaN(e)||(e=parseInt(e),0<e&&e<24||(e=0));isNaN(f)||(f=parseInt(f),f>0&&f<60||(f=0));isNaN(h)||(h=parseInt(h),h>0&&h<60||(h=0));d.setHours(e);d.setMinutes(f);d.setSeconds(h);e=a.youi.dateUtil.dateToStr(d,this.options.format);this.element.find(".datepicker-content .selected").removeClass("selected");this.element.find(".datepicker-content #"+
b).addClass("selected");this.options.bind&&(a(this.options.bind).val(e),this.close());if(a.isFunction(this.options.onSelect))this.options.onSelect(d,e)},selectDate:function(a){this._selectDate(a)},nextYear:function(){var a=this.getDate(),b=a.getFullYear(),a=a.getMonth();this.goDate(b+1,a)},prevYear:function(){var a=this.getDate(),b=a.getFullYear(),a=a.getMonth();this.goDate(b-1,a)},prevMonth:function(){var a=this.getDate(),b=a.getFullYear(),a=a.getMonth();a--;a==-1&&(a=11,b--);this.goDate(b,a)},nextMonth:function(){var a=
this.getDate(),b=a.getFullYear(),a=a.getMonth();a++;a==12&&(a=0,b++);this.goDate(b,a)},getDate:function(){return this.currentDate},goDate:function(a,b){this.element.find(".datepicker-dateInfo").html(this._getYearMonthStr(a,b));this.element.find(".datepicker-content").html(this._generateContentHtml(a,b));this.currentDate=new Date(a,b,1)},open:function(b,d){d&&(this.options.bind=d);b||(b=new Date);this.selectedDate=b;this.goDate(b.getFullYear(),b.getMonth(),b.getDate());this.element.removeClass("datepicker-hide");
a("input.datepicker-time.HH",this.element).val(b.getHours());a("input.datepicker-time.MI",this.element).val(b.getMinutes());a("input.datepicker-time.SS",this.element).val(b.getSeconds());a.youi.popUtils.showPopBackground()},close:function(){this.element.addClass("datepicker-hide");a.youi.popUtils.hidePopBackground()},clear:function(){this.options.bind.val("");this.options.bind.next(".value").val("");this.element.find(".selected").removeClass("selected")}});a.extend(a.youi.datepickerPanel,{version:"1.0.0",
defaults:{format:"yyyy-MM-dd"}});Date.prototype.igSetLocale=function(a,b,e,f,h){this.mnths=a===null?this.en_mnths:a.split(",");this.months=b===null?this.en_months:b.split(",");this.dys=e===null?this.en_dys:e.split(",");this.days=f===null?this.en_days:f.split(",");this.ampms=h===null?this.en_ampms:h.split(",")};Date.prototype.itoa=function(a,b){for(var e=""+a,f=e.length,h=0;h<b-f;++h)e="0"+e;f>b&&(e=e.substr(f-b));return e};Date.prototype.igFormat=function(a){for(var d=this.getFullYear(),e=this.getMonth(),
f=this.getDate(),h=this.getDay(),g=this.getHours(),i=this.getMinutes(),k=this.getSeconds(),a=new b(a),j="";a.parse_format()!=-1;)switch(a.value){case "yyyy":j+=this.itoa(d,4);break;case "yy":j+=this.itoa(d,2);break;case "y":j+=this.itoa(d,4);break;case "MMMM":j+=this.months[e];break;case "MMM":j+=this.mnths[e];break;case "NNN":j+=this.mnths[e];break;case "MM":j+=this.itoa(1+e,2);break;case "M":j+=1+e;break;case "dd":j+=this.itoa(f,2);break;case "d":j+=f;break;case "EEEE":case "EE":j+=this.days[h];
break;case "E":j+=this.dys[h];break;case "hh":j+=this.itoa(g%12===0?12:g%12,2);break;case "h":j+=g%12===0?12:g%12;break;case "HH":j+=this.itoa(g,2);break;case "H":j+=g;break;case "KK":j+=this.itoa(g%12,2);break;case "K":j+=g%12;break;case "kk":j+=this.itoa(g===0?24:g,2);break;case "k":j+=g===0?24:g;break;case "mm":j+=this.itoa(i,2);break;case "m":j+=i;break;case "ss":j+=this.itoa(k,2);break;case "s":j+=k;break;case "a":j+=g<12?this.ampms[0]:this.ampms[1];break;case "W":j+=this.getWeekInMonth(f);break;
case "w":j+=this.getWeekInYear(this);break;default:j+=a.value}return j};Date.prototype.getWeekInMonth=function(a){return Math.ceil(a/7)};Date.prototype.getWeekInYear=function(a){var b=new Date(a.getFullYear(),0,1);return Math.ceil(((a-b)/864E5+b.getDay())/7)};Date.prototype.igParse=function(a,d){for(var d=d||"yyyy-MM-dd",e=new b(a),f=new b(d),h=-1,g=-1,i=-1,k=-1,j=-1,m=-1,l=-1,o=0;e.parse_format()!=-1;)switch(e.value){case "yyyy":h=f.parse_number(4,0,9999);if(h<0)return null;break;case "yy":h=f.parse_number(2,
0,99);if(h<0)return null;h+=h>50?1900:2E3;break;case "y":h=f.parse_number(4,0,9999);h<0&&(h=f.parse_number(2,0,99),h>=0&&(h+=2E3));if(h<0)return null;break;case "MMM":case "MMMM":case "NNN":g=f.parse_string(this.mnths,false);g<0&&(g=f.parse_string(this.months,false));if(g<0)return null;break;case "MM":g=f.parse_number(2,1,12);if(g<0)return null;--g;break;case "M":g=f.parse_number(2,1,12);g<0&&(g=f.parse_number(1,1,12));if(g<0)return null;--g;break;case "dd":i=f.parse_number(2,1,31);if(i<0)return null;
break;case "d":i=f.parse_number(2,1,31);i<0&&(i=f.parse_number(1,1,31));if(i<0)return null;break;case "EEEE":case "EE":k=f.parse_string(this.days,false);if(k<0)return null;break;case "E":k=f.parse_string(this.dys,false);if(k<0)return null;break;case "hh":j=f.parse_number(2,1,12);if(j<0)return null;j==12&&(j=0);break;case "h":j=f.parse_number(2,1,12);j<0&&(j=f.parse_number(1,1,12));if(j<0)return null;j==12&&(j=0);break;case "HH":j=f.parse_number(2,0,23);if(j<0)return null;break;case "H":j=f.parse_number(2,
0,23);j<0&&(j=f.parse_number(1,0,23));if(j<0)return null;break;case "KK":j=f.parse_number(2,0,11);if(j<0)return null;break;case "K":j=f.parse_number(2,0,11);j<0&&(j=f.parse_number(1,0,11));if(j<0)return null;break;case "kk":j=f.parse_number(2,1,24);if(j<0)return null;j==24&&(j=0);break;case "k":j=f.parse_number(2,1,24);j<0&&(j=f.parse_number(1,1,24));if(j<0)return null;j==24&&(j=0);break;case "mm":m=f.parse_number(2,0,59);if(m<0)return null;break;case "m":m=f.parse_number(2,0,59);m<0&&(m=f.parse_number(1,
0,59));if(m<0)return null;break;case "ss":l=f.parse_number(2,0,59);if(l<0)return null;break;case "s":l=f.parse_number(2,0,59);l<0&&(l=f.parse_number(1,0,59));if(l<0)return null;break;case "a":o=f.parse_string(this.ampms,false);if(o<0)return null;break;case " ":f.parse_space();break;case "w":break;case "W":break;default:if(f.parse_char()<0)return null;if(e.value!=f.value)return null}h!=-1&&this.setFullYear(h);g!=-1?(i==-1&&(previousDate=this.getDate()),this.setDate(1),this.setMonth(g),i!=-1?this.setDate(i):
this.setDate(previousDate)):i!=-1&&this.setDate(i);j!=-1&&this.setHours(o===0?j:j+12);m!=-1&&this.setMinutes(m);l!=-1&&this.setSeconds(l);return k!=-1&&this.getDay()!=k?null:this};Date.prototype.en_mnths="Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(",");Date.prototype.en_months="January,February,March,April,May,June,July,August,September,October,November,December".split(",");Date.prototype.en_dys="Mon,Tue,Wed,Thu,Fri,Sat,Sun".split(",");Date.prototype.en_days="Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday".split(",");
Date.prototype.en_ampms=["am","pm"];Date.prototype.mnths=this.en_mnths;Date.prototype.months=this.en_months;Date.prototype.dys=this.en_dys;Date.prototype.days=this.en_days;Date.prototype.ampms=this.en_ampms})(jQuery);(function(a){a.ui.dialog||(a.widget("youi.dialog",a.extend({},a.ui.mouse,{options:{position:"center",width:800,zIndex:1E3},_create:function(){this.element.addClass("youi-dialog");this.originalTitle=this.element.attr("title");this.dialogId=a.youi.dialog.getId(this.element);this.origContainter=this.element.parent();this._createDialogContianer();this.uiDailogContianer.find(".youi-dialog-content:first").append(this.element);this._initAction();a("#"+this.dialogId).width(this.options.width)},_defaultHtmls:function(){},
_createDialogContianer:function(){this.uiDailogContianer=a('<div id="'+this.dialogId+'" style="z-index:'+this.options.zIndex+'" class="youi-dialog-container"/>');var b=[],c=this.options.title||this.originalTitle||"&nbsp;";b.push('<div class="youi-dialog-titlebar">');b.push("\t<div><div><a></a><a>"+c+"</a></div></div>");this.options.hideCloseIcon!=true&&b.push('\t<a title="\u5173\u95ed" class="youi-dialog-titlebar-close"></a>');b.push("</div>");b.push('<div class="youi-dialog-ml"><div class="youi-dialog-mr"><div class="youi-dialog-content"></div></div></div>');
b.push('<div class="youi-dialog-bl"><div class="youi-dialog-br"><div class="youi-dialog-buttonpane');this.options.buttons&&this.options.buttons.length>0?(b.push(' buttons">'),b.push(this._buttonsHtml())):b.push('">');b.push("</div></div></div>");b.push('<div class="dragging-dialog-helper"></div>');this.uiDailogContianer.html(b.join(""));b=this.element.parents(".youi-page:first");b.length&&b.page("addDialog",this.uiDailogContianer);a("body",document).append(this.uiDailogContianer)},_buttonsHtml:function(){var b=
['<table border="0" cellpadding="0" align="center"><tr>'];a(this.options.buttons).each(function(){b.push('<td valign="top">');b.push(a.youi.buttonHtmls(this.name,this.caption,["dialog-button"],this.caption));b.push("</td>")});b.push("</tr></table>");return b.join("")},_initAction:function(){var b=this;a("#"+this.dialogId+" .youi-dialog-titlebar").mousable({delay:100,start:function(c){a(".dragging-dialog-helper",this.parentNode).addClass("youi-dragging").css({width:this.parentNode.offsetWidth,height:this.parentNode.offsetHeight,
left:0,top:0});b.originalOffsetLeft=c.pageX-this.parentNode.offsetLeft;b.originalOffsetTop=c.pageY-this.parentNode.offsetTop;a(this.parentNode).disableSelection();return true},drag:function(c){var d=c.pageX-this.parentNode.offsetLeft-b.originalOffsetLeft,c=c.pageY-this.parentNode.offsetTop-b.originalOffsetTop;a(".dragging-dialog-helper",this.parentNode).css({left:d,top:c})},stop:function(){var c=a(".dragging-dialog-helper",this.parentNode),d=c.offset();if(d.top<0)d.top=0;a(this.parentNode).css(d);
c.removeClass("youi-dragging");b.originalOffsetLeft=null;b.originalOffsetTop=null;a(this.parentNode).enableSelection()}});a("#"+this.dialogId+" .youi-dialog-titlebar-close").bind("mouseover",function(){a(this).addClass("over")}).bind("mouseout",function(){a(this).removeClass("over")}).bind("click",function(){b.close()});a("#"+this.dialogId+" .youi-dialog-buttonpane button").bind("click",function(){var a=this.getAttribute("id");b._execButton(a)})},_execButton:function(a){var c=this.options.buttons;
if(c&&c.length)for(var d=0;d<c.length;d++)if(c[d].name==a){c[d].action();break}},open:function(b,c){var d=this.options,e=this.uiDailogContianer;if(!e.is(":visible"))e&&!e.parent().is("body")&&a("body",document).append(e),this.overlay=d.modal?new a.youi.dialog.overlay(this):null,this._position(this.options.position),b&&a(".youi-dialog-titlebar a:first",e).text(b),c&&(e.css("zIndex",c),this.overlay.$el.css("zIndex",c-1)),e.show(),a.ui.hasScroll(a("body",document))||a("body",document).addClass("dialog-open"),
this.element.find(".dialog-open-handle").trigger("dialog.open")},_position:function(b){var c=this.uiDailogContianer,d=a(window),e=a(document),f=e.scrollTop(),e=e.scrollLeft(),h=f;a.inArray(b,["center","top","right","bottom","left"])>=0&&(b=[b=="right"||b=="left"?b:"center",b=="top"||b=="bottom"?b:"middle"]);b.constructor!=Array&&(b=["center","middle"]);if(b[0].constructor==Number)e+=b[0];else switch(b[0]){case "left":e+=0;break;case "right":e+=d.width()-c.outerWidth();break;default:case "center":e+=
(d.width()-c.outerWidth())/2}if(b[1].constructor==Number)f+=b[1];else switch(b[1]){case "top":f+=0;break;case "bottom":f+=d.height()-c.outerHeight();break;default:case "middle":f+=(d.height()-c.outerHeight())/2}f=Math.max(f,h);c.css({top:f,left:e})},close:function(){a.youi.editorFactory.closeEditor();if(!a.isFunction(this.options.close)||this.options.close.apply(this.element[0]))this.closeOverlay(),this.uiDailogContianer.hide(),a("body",document).removeClass("dialog-open")},closeOverlay:function(){this.overlay&&
this.overlay.destroy()},destroy:function(){this.overlay&&this.overlay.destroy();var a=this.uiDailogContianer;this.element.unbind(".dialog").removeData("dialog").removeClass("youi-dialog-content").hide();this.origContainter.append(this.element);this.originalTitle&&this.element.attr("title",this.originalTitle);a.remove();this.uiDailogContianer=this.origContainter=null}})),a.extend(a.youi.dialog,{version:"1.0.0",uuid:0,getId:function(a){return"youi-dialog-"+(a.attr("id")||++this.uuid)},overlay:function(b){this.$el=
a.youi.dialog.overlay.create(b)}}),a.extend(a.youi.dialog.overlay,{instances:[],maxZ:0,create:function(b){var c=a("<div></div>").appendTo(document.body).addClass("ui-widget-overlay").css({width:this.width(),height:this.height()}).css("zIndex",b.options.zIndex-1);b.options.bgiframe&&a.fn.bgiframe&&c.bgiframe();this.instances.push(c);return c},destroy:function(b){this.instances.splice(a.inArray(this.instances,b),1);b.remove();var c=0;a.each(this.instances,function(){c=Math.max(c,this.css("z-index"))});
this.maxZ=c},height:function(){if(a.support.boxModel)return a(document).height()+"px";else{var b=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),c=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);return b<c?a(window).height()+"px":b+"px"}},width:function(){if(a.support.boxModel)return a(document).width()+"px";else{var b=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),c=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);
return b<c?a(window).width()+"px":b+"px"}},resize:function(){var b=a([]);a.each(a.youi.dialog.overlay.instances,function(){b=b.add(this)});b.css({width:0,height:0}).css({width:a.youi.dialog.overlay.width(),height:a.youi.dialog.overlay.height()})}}),a.extend(a.youi.dialog.overlay.prototype,{destroy:function(){a.youi.dialog.overlay.destroy(this.$el)}}),a.extend(a.youi.msgbox,{version:"1.0.0",defaults:{title:"\u6d88\u606f\u63d0\u793a\u6846",confirmable:false,submitArgs:["arg1"],submit:function(a){alert("\u786e\u5b9a"+
a)}}}))})(jQuery);(function(a){this.version="1.0.0";this.editors={};this.register=function(a,c){this.editors[a]=$.extend({editor:a},c);this.editors[a].create.apply(this.editors[a]);return this};this.open_=function(a,c){a=$.extend({name:"fieldText",property:"fieldText"},a);a.property="e_"+a.property;if((this.openEditor=this.editors[a.name])&&$.isFunction(this.openEditor.open))this.openEditor.model=a,this.openEditor.open.apply(this.openEditor,[a,c]);this.openEditor=this.editors[a.name];return this};this.closeEditor=
function(){this.openEditor&&(this.openEditor.close.apply(this.openEditor),$.isFunction(this.openEditor.model.closeEvent)&&this.openEditor.model.closeEvent.apply(this.openEditor,[this.openEditor.model.value,this.openEditor.model.text,this.openEditor.model.oldValue]));this.openEditor=null;return this};a.youi.editorFactory=this;return a})(jQuery);
(function(a){a.widget("youi.editor",{options:{editorClass:"cell"},_create:function(){this.element.addClass("youi-editor");this._initAction()},_initAction:function(){this.element.bind("editor.open",function(b,d,e){a(this).editor("close");d.addClass("editing");e.cell=d;a.youi.editorFactory.open_(e,this)}).bind("editor.close",function(b,d){d.removeClass("editing");a.youi.editorFactory.closeEditor()}).bind("editor.position",function(){a(".editing:first",this)}).bind("click",function(){a.youi.editorFactory.closeEditor()});
a("body",document).bind("click",function(){a.youi.editorFactory.closeEditor()})},open:function(){var a=this.element.find("."+this.options.editorClass+".editing");a.length==0&&(a=this.element.find("."+this.options.editorClass+":first"));this.element.trigger("editor.open",[a])},close:function(){this.element.trigger("editor.close",[this.element.find(".editing")]);return true}});var b={create:function(){},open:function(b){this.cell=b.cell;var d=b.name,b=a.extend({property:"editor_"+d},b),e="editorPanel_"+
d+"_"+b.property.replace(/\./g,"_");this.editorPanel=a("#"+e);if(this.editorPanel.length==0)b.change=function(b){b&&a.youi.editorFactory.closeEditor()},b.afterSetValue=function(){a.youi.editorFactory.closeEditor()},b.select=function(b){b&&a.youi.editorFactory.closeEditor()},this.editorPanel=a('<div class="editorPanel" id="'+e+'"></div>').appendTo(a("body",document)),this.editorPanel.append(a("<div></div>")[d](b)),this.editorPanel.bind("mousedown click",function(a){a.stopPropagation()});b=this.editorPanel.find(">div");
b.fieldValue(this.cell.attr("value")||this.cell.text());b[d]("setWidth",this.cell.width()-2);this.editorPanel.css({top:this.cell.offset().top+1,left:this.cell.offset().left,height:this.cell.height(),width:this.cell.width()-1}).show();b.fieldFocus()},close:function(){if(this.editorPanel&&this.editorPanel.length){var b=this.editorPanel.find(">div.youi-field");b.fieldValidate();a(".editorPanel").hide();var d=b.fieldValue()||"",e=b.fieldShow()||"",f=this.cell.attr("value")||this.cell.text();if(this.model){this.model.oldValue=
f;var h=this.model.renderer;if(h){if(typeof h==="string")model.renderer=h=a.youi.formatUtils[h];typeof h==="function"&&(e=h.call(this.model,d,this.col.record,this.col.rowIndex,this.col.colIndex))}}this.cell.not(".edited").length==1&&f!=d?(this.cell.addClass("edited"),this.cell.html(e).attr("value",d)):this.cell.is(".edited")&&this.cell.html(e).attr("value",d);this.model.value=d;this.model.text=e;if(b.hasClass("validate-error"))return b=a.youi.resourceUtils.get("grid.editor.errorMessage",this.model.rowIndex,
this.model.colIndex,b.attr("title")),this.cell.addClass("validate-error").attr("title",b),false;else this.cell.attr("title",e).removeClass("validate-error")}}};a.each(["fieldText","fieldSelect","fieldCalendar","fieldPassword","fieldTree"],function(){a.youi.editorFactory.register(this,b)});a.youi.editorFactory.register("form",{create:function(){},open:function(b){var d=a("#"+b.formId),e=this,f=b.cell,h=f.attr("value")||f.text()||"",g=f.parents(".youi-editor:first"),i=b.beforeSubmit;d.form("open").attr("openValue",
h).form("reset");d.form("fieldValue","code",h);d.form("fieldValue","show",f.text());d.hasClass("form-dailog-opened")||(d.addClass("form-dailog-opened"),window[b.formId+"_beforeSubmit"]=function(){var b=a(this),c=b.form("getFormRecord");if(!(a.isFunction(i)&&i.apply(this,[c])===false)){var d=g.find(".editing:first"),l=c.code||"";a.isArray(l)&&(l=l.join());d.addClass("edited").attr("value",l);d.html(c.show||l);d.attr("title",d.text());e.model.value=c.code;e.model.text=d.text();e.model.oldValue=b.attr("openValue");
a(this).form("close")}})},close:function(){}})})(jQuery);(function(a){function b(c,d){var h={},g,i,k;for(k in c)i=c[k],g=(d?d+"_":"")+k,i==null||i==""||(typeof i=="string"||typeof i=="number"||i.length?h[g]=i:typeof i=="object"&&a.extend(h,b(i,(d?d+"_":"")+k)));return h}function c(b,c){function h(){if(!s++){o.detachEvent?o.detachEvent("onload",h):o.removeEventListener("load",h,false);var b=true;try{if(t)throw"timeout";var c,e;e=o.contentWindow?o.contentWindow.document:o.contentDocument?o.contentDocument:o.document;if(!(k.dataType=="xml"||e.XMLDocument||
a.isXMLDoc(e))&&(e.body==null||e.body.innerHTML=="")){if(--v){s=0;setTimeout(h,100);return}d.info("Could not access iframe DOM after 50 tries.");return}n.responseText=e.body?e.body.innerHTML:null;n.responseXML=e.XMLDocument?e.XMLDocument:e;n.getResponseHeader=function(a){return{"content-type":k.dataType}[a]};if(k.dataType=="json"||k.dataType=="script"){var i=e.getElementsByTagName("textarea")[0];if(i)n.responseText=i.value;else{var f=e.getElementsByTagName("pre")[0];if(f)n.responseText=f.innerHTML}}else if(k.dataType==
"xml"&&!n.responseXML&&n.responseText!=null)n.responseXML=g(n.responseText);c=jQuery.parseJSON(n.responseText)}catch(j){b=false,k.error.apply(k,[c.errorMsg])}if(b){if(!a.youi.ajaxUtil.resultsCheck(c,{error:k.error,domainValidator:c.domainValidator}))return;k.success(c,"success");p&&a.event.trigger("ajaxSuccess",[n,k])}p&&a.event.trigger("ajaxComplete",[n,k]);p&&!--a.active&&a.event.trigger("ajaxStop");k.complete&&k.complete(n,b?"success":"error");setTimeout(function(){l.remove();n.responseXML=null},
100)}}function g(a,b){window.ActiveXObject?(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a)):b=(new DOMParser).parseFromString(a,"text/xml");return b&&b.documentElement&&b.documentElement.tagName!="parsererror"?b:null}var i=b[0];if(a(":input[name=submit]",i).length)alert('Error: Form elements must not be named "submit".');else{var k=a.extend({},a.ajaxSettings,c),j=a.extend(true,{},a.extend(true,{},a.ajaxSettings),k),m="jqFormIO"+(new Date).getTime(),l=a('<iframe id="'+m+'" name="'+
m+'" src="'+k.iframeSrc+'" />'),o=l[0];l.css({position:"absolute",top:"-1000px",left:"-1000px"});var n={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(){this.aborted=1;l.attr("src",k.iframeSrc)}},p=k.global;p&&!a.active++&&a.event.trigger("ajaxStart");p&&a.event.trigger("ajaxSend",[n,k]);if(j.beforeSend&&j.beforeSend(n,j)===false)j.global&&a.active--;else if(!n.aborted){var s=
0,t=0;if(j=i.clk){var u=j.name;if(u&&!j.disabled&&(c.extraData=c.extraData||{},c.extraData[u]=j.value,j.type=="image"))c.extraData[name+".x"]=i.clk_x,c.extraData[name+".y"]=i.clk_y}setTimeout(function(){var g=b.attr("target"),d=b.attr("action");i.setAttribute("target",m);i.getAttribute("method")!="POST"&&i.setAttribute("method","POST");i.getAttribute("action")!=k.url&&i.setAttribute("action",k.url);c.skipEncodingOverride||b.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"});k.timeout&&
setTimeout(function(){t=true;h()},k.timeout);var n=[];try{if(c.extraData)for(var p in c.extraData)n.push(a('<input type="hidden" name="'+p+'" value="'+c.extraData[p]+'" />').appendTo(i)[0]);l.appendTo("body");o.attachEvent?o.attachEvent("onload",h):o.addEventListener("load",h,false);i.submit()}finally{i.setAttribute("action",d),g?i.setAttribute("target",g):b.removeAttr("target"),a(n).remove()}},10);var v=50}}}var d=a.youi.log;a.widget("youi.form",{_create:function(){this._initAction()},_initAction:function(){var b=
a.extend({submit:function(){a(this).parents("form:first").form("submit")},reset:function(){a(this).parents("form:first").form("reset")},clear:function(){a(this).parents("form:first").form("clear")},close:function(){a(this).parents("form:first").form("close")},remove:function(){a(this).parents("form:first").form("remove")}},this.options.buttonActions);a.youi.buttonUtils.addButtonActionListener(this.element.find(">.form-buttons"),b);this.element.bind("submit.form",function(){a(this).form("submit");
return false});this.element.delegate("input.textInput","keydown",function(b){b.keyCode==13&&a(b.liveFired).form("submit")})},getFormRecord:function(){var b={};this.element.find(".youi-field").each(function(){var c=this.getAttribute("property"),d;c&&(d=a(this).fieldValue())&&(b[c]=d)});return b},getFieldValues:function(){var b=[];this.element.find(".youi-field").each(function(){var c=this.getAttribute("property"),d;c&&((d=a(this).fieldValue())&&(typeof d=="string"?b.push({property:c,value:d}):d&&a.isArray(d)?
typeof d[0]=="object"?a(d).each(function(a){for(var d in this)b.push({property:c+"["+a+"]."+d,value:this[d]})}):a(d).each(function(a){b.push({property:c+"["+a+"]",value:this})}):d&&typeof d==="object"&&(b=b.concat(a.youi.recordUtils.recordToParameters(d)))),d=null)});return b},fieldValue:function(a,b){return this.element.find(".youi-field[property="+a+"]").fieldValue(b)},fieldDefaultValue:function(a,b){var c=this.element.find('.youi-field[property="'+a+'"]');c.fieldDefaultValue(b);c.fieldReset()},
fillRecord:function(b){this.record=b;var c=","+(this.options.idKeys||"")+",";this.element.find(".youi-field").each(function(){var h=this.getAttribute("property"),g=a("input.textInput",this).attr("showProperty"),i=a.youi.recordUtils.getPropertyValue(b,h);if(i!=null&&i.length!=0)try{var k=!g?null:a.youi.recordUtils.getPropertyValue(b,g),j=a(this);j.fieldValue(i,k);c.indexOf(","+h+",")!=-1&&j.fieldDisabled()}catch(m){d.info("\u8bbe\u7f6e\u503c\u5f02\u5e38\uff1a"+m)}})},_isRecordChange:function(){if(this.avoidRecordChange==
true)return false;var c=b(this.record),d=false;this.element.find(".youi-field").each(function(){var b=this.getAttribute("property")||" ",b=c[b.replace(/\./g,"_")],g=a(this).fieldValue();if(!b&&!g)return false;!d&&b!=g&&(d=true)});return d},noRecordChange:function(){this.noRecordChange=true},loadRecord:function(b,c,d){if(this.options.findAction&&this.options.idKeys){for(var g=this.options.findAction,i=this.getFormRecord(),k=this.options.idKeys.split(","),j,m=0;m<k.length;m++)j=a.youi.recordUtils.getPropertyValue(i,
k[m]),g=a.youi.parameterUtils.connectParameter(g,k[m],j);if(d)for(var l in d)g=a.youi.parameterUtils.connectParameter(g,l,d[l]);this.find(g,b,c)}},find:function(b,c,d){this.element.find(".youi-field").fieldReset();a.youi.ajaxUtil.ajax({url:b,widgetId:this.options.id,afterFind:c,success:function(b){b&&b.record&&(a("#"+this.widgetId).form("fillRecord",a.extend({},b.record,d)),a.isFunction(this.afterFind)&&this.afterFind.apply(this,[b.record]))}})},validate:function(){this.element.find(".youi-field").fieldValidate();
return this.element.find(".youi-field.validating,.youi-field.validate-error,.edited.validate-error").length==0?true:false},diabledSubmitButton:function(){this.element.find("#button-submit").addClass("disabled")},activeSubmitButton:function(){this.avoidRecordChange=false;this.element.find("#button-submit").removeClass("disabled")},submitAction:function(a,b,c){var g=this.element.attr("action");this.element.attr("action",a);this.submit(b,c);this.element.attr("action",g)},submit:function(b,d){this.diabledSubmitButton();
if(!this.options.confirmMessage||window.confirm(this.options.confirmMessage))if(this.validate())if(a.isFunction(window[this.options.id+"_beforeSubmit"])&&!window[this.options.id+"_beforeSubmit"].apply(this.element[0]))this.activeSubmitButton();else{this.avoidRecordChange=true;var h=this.getFieldValues(),g=[];d&&g.push("method="+d);this.element.hasClass("operant-add")?g.push("operant=1"):g.push("operant=2");a.isArray(b)&&(h=h.concat(b));for(var i=0;i<h.length;i++)g.push(a.youi.parameterUtils.propertyParameter(h[i].property,
h[i].value));this.element.find("input.extra-field").each(function(){g.push(this.getAttribute("name")+"="+this.value)});if(h=a.trim(this.element.attr("action"))){var h=(h=(h.match(/^([^#]+)/)||[])[1])||window.location.href||"",k=false;a(".youi-field input:file",this.element).each(function(){this.value&&(k=true)});var j=this.options.id,i=g.join("&"),h={url:h,data:i,dataType:"json",id:this.options.id,formDoc:this.element[0],success:function(b){a.isFunction(window[this.id+"_afterSubmit"])&&window[this.id+
"_afterSubmit"].apply(this.formDoc,[b]);b=a(this.formDoc);b.form("activeSubmitButton");b.trigger("form.afterSubmit");b.find(".youi-field").trigger("form.submit",[]);this.formDoc=this.id=null},domainValidator:function(b){a.youi.messageUtils.showMessage(a.youi.resourceUtils.get("form.invalid",b.message.info))},error:function(){a("#"+j).form("activeSubmitButton");a.youi.log.error("\u5730\u5740\u3010"+this.url+"\u3011\u8bbf\u95ee\u5f02\u5e38")}};k?(h=a.extend({},h,{iframeSrc:/^https/i.test(window.location.href||
"")?"javascript:false":"about:blank",extraData:g.join("&")}),c(this.element,h)):a.youi.ajaxUtil.ajax(h)}else a.isFunction(window[this.options.id+"_afterSubmit"])&&window[this.options.id+"_afterSubmit"].apply(this.element[0],[{record:this.getFormRecord()}])}else{var m=[];this.element.find(".youi-field.validating,.youi-field.validate-error,.edited.validate-error").each(function(){this.title&&m.push(this.title)});a.youi.messageUtils.showError(m.join("\n"));this.activeSubmitButton()}},fieldReset:function(){this.element.find(".youi-field").fieldReset();
var a=this.options.idKeys;if(a)for(var a=a.split(","),b=0;b<a.length;b++){var c=this.element.find(".youi-field[property="+a[b]+"]");c.length&&c.fieldEnable&&c.fieldEnable()}},reset:function(){this.fieldReset();this.record&&this.fillRecord(this.record);a.isFunction(window[this.options.id+"_reset"])&&window[this.options.id+"_reset"].apply(this.element[0])},clear:function(){var a=this.element.find(".youi-field");a.fieldClear();a.fieldReset();this.record=null},open:function(b,c,d){this.operant=c;this.record=
null;a.youi.editorFactory&&a.youi.editorFactory.closeEditor();a(".validate-success",this.element).removeClass("validate-success");a(".validate-error",this.element).removeClass("validate-success").removeAttr("title");this.element.dialog({autoOpen:false,hideCloseIcon:this.options.hideCloseIcon,width:(this.options.width||800)+28,title:this.options.caption,modal:true,minHeight:this.element.outerHeight()+100,overlay:{opacity:0.2,background:"#A8A8A8"},zIndex:this.options.zIndex,close:this.options.close}).show().dialog("open",
b,d);a(window).resize()},remove:function(){if(window.confirm("\u786e\u8ba4\u5220\u9664\uff1f")){var b=this.options.idKeys;if(b&&this.options.removeAction){for(var b=b.split(","),c=[],d=0;d<b.length;d++){var g=this.element.find(".youi-field[property="+b[d]+"]").fieldValue();g&&c.push(a.youi.parameterUtils.propertyParameter(b[d],g))}c.length&&a.youi.ajaxUtil.ajax({url:this.options.removeAction,data:c.join("&"),formId:this.element.attr("id"),formDoc:this.element[0],success:function(b){var c=this.formId+
"_afterRemove";if(!a.isFunction(window[c])||window[c].apply(this.formDoc,[b]))this.formDoc=null}})}}},close:function(){this.element.dialog("close");a.youi.editorFactory&&a.youi.editorFactory.closeEditor();this.avoidRecordChange=false},destory:function(){a.Widget.prototype.destroy.apply(this,arguments)}});a.extend(a.youi.form,{version:"1.0.0",defaults:{},getter:["getFormRecord","getFieldValues"],extraInputHtml:function(a,b){return'<input class="extra-field" type="hidden" value="'+b+'" name="'+a+'"/>'}})})(jQuery);(function(a){function b(a,b,g,e,i,f,h,k){var j=[],m=[],e=d(i,b,e),q=["row",i%2?"old":"even"],r=b.level;k==true&&r&&(q.push("tree-level-"+r),r=="1"&&q.push("show expandable"));f==true&&q.push("row-new");m.push('<tr id="'+e+'" class="'+q.join(" ")+'">');h&&j.push('<tr id="'+e+'" class="'+q.join(" ")+'">');for(f=0;f<g.length;f++)h&&g[f].fixed==true?j.push(c(a,e,b,g[f],i,f)):m.push(c(a,e,b,g[f],i,f));h&&j.push("</tr>");m.push("</tr>");return[m.join(""),j.join("")]}function c(b,c,g,d,e){var i,f=[],h,k,
j;h=a.isFunction(d.defaultValue)?d.defaultValue(record,d,e):d.defaultValue;i=a.youi.recordUtils.getPropertyValue(g,d.property);i=i==null?h:i;h=a.youi.serverConfig.convertArray[d.convert];d&&d.convert&&h&&(k=h[i]||d.notConvertValue||i);a.isFunction(d.renderer)&&(i=d.renderer(d,g));k=k||i;switch(d.type){case "checkbox":j=a.youi.htmlUtils.buildIconHtml(d.type);break;case "radio":j=a.youi.htmlUtils.buildIconHtml(d.type);break;case "num":j=e+1;break;case "tree":j='<span class="youi-icon tree-toggle-handler"></span><span class="tree-node-text">'+
k+"</span>";break;case "date":if(i)d.format=d.format||"millis",d.textFormat=d.textFormat||"yyyy-MM-dd HH:mm:ss",c=a.youi.dateUtil.strToDate(i,d.format),j=a.youi.dateUtil.dateToStr(c,d.textFormat);break;case "link":j=[];b=b+"_link_"+d.property;j.push('<a href="###" ');a.isFunction(window[b])&&j.push(' onclick="'+b+"('"+c+"');\"");j.push(" >");j.push(k);j.push("</a>");j=j.join("");break;default:j=k||i}c=j;k=["cell"];b=d.align;f.push("<td ");b&&f.push(' align="'+d.align+'"');d.editor&&(k.push("editable "+
d.editor),f.push(' editor="'+d.editor+'" '));a.inArray(d.type,["tree","num","link"])&&k.push(d.type);d.type=="tree"&&k.push("grid-tree-node");a.youi.stringUtils.notEmpty(i)&&f.push(' value="'+i+'"');d.renderer&&k.push(d.property);if(d.highlight)try{(new Function("var args = Array.prototype.slice.call( arguments, 0 );var value=args[0],record=args[1];"+d.highlight))(i,g)==true&&k.push(d.property+" highlight highlight_"+i)}catch(m){}f.push(' class="'+k.join(" ")+'">');f.push(c);f.push("</td>");return f.join("")}
function d(b,c,d){if(d){var b=d.split(","),g=[];a.each(b,function(){g.push(a.youi.recordUtils.getPropertyValue(c,this))});b=g.join()}else b="row_"+b;return b}function e(b,c,d,g){var g=g||"",b=b.getAttribute("id"),d=d.split(","),i=b.split(","),e=c;a.each(d,function(b){e=a.youi.parameterUtils.connectParameter(e,g+this,i[b]||" ")});return e}function f(b,c,d){var g=[],d=d||"",b=b.getAttribute("id"),c=c.split(","),i=b.split(",");a.each(c,function(b){g.push(a.youi.parameterUtils.propertyParameter(d+this,
i[b]||" "))});return g}function h(a){return!a||!a.orderBy?"":"orderBy="+a.orderBy+":"+(a.sortProperty||a.property)}function g(){a.youi.editorFactory.closeEditor()}function i(a){if(!a)return"";for(var a=a.className.split(" "),b=0;b<a.length;b++)if(a[b].indexOf("tree-level-")==0)return a[b];return""}function k(a){a=a.substring(11);return parseInt(a)}function j(b){var c=a(".grid-content .grid-scroll tr.row.selected",b).length;c==0?(a(".youi-button.active-1",b).addClass("disabled"),a(".youi-button.active-2",
b).addClass("disabled")):(c==1?a(".youi-button.active-1",b).removeClass("disabled"):a(".youi-button.active-1",b).addClass("disabled"),a(".youi-button.active-2",b).removeClass("disabled"))}function m(a,b,c){a=a||{};if(b&&c)for(var b=b.split(","),c=c.split(","),d=0;d<b.length;d++)a[b[d]]=c[d];return a}a.widget("youi.grid",a.ui.mouse,a.extend({},a.youi.dragSupport,{options:{showCheckbox:false,showRadio:false,checkboxWidth:25,showNum:false,numWidth:25,pageSize:10,queryPageSize:20,srcType:"json",containerParent:"#system-container",
delay:100,editModel:true,distance:1,initHtml:true,fixed:true},currentPageIndex:1,_create:function(){this.element.addClass("youi-grid");this._initVar();this._defaultHtmls();this._initAction();this.options.container=this.element;this._mouseInit();this._autoFull();this._fixedXScroll();this._autoHeight();if(this.options.parentId)this.options.load=false;this.options.load==true?this.pReload():(j(this.element),this._bindParentGrid());this._bindDataForm()},_autoFull:function(){if(this.element.is(":visible")){var a=
this.element.find(".grid-fixed table"),b=this.element.find(".grid-scroll .header-table:first"),c=b.find(".col-width:last");a.parent().parent().width(this.fixedWidth);b=b.parent().width()-b.width();b>5&&(a=this.element.find(".col-width:last"),a.hasClass("auto-full")||(b=c.width()+b,a.addClass("auto-full").width(b),c.width(b)))}},_autoHeight:function(){if(this.element.is(":visible")){var a=this.element.offsetParent();if(a.length){var b=this.element,c=this.element.parent().parent();c.is(".youi-panel")&&
(b=c);var d=this.element.find(".grid-content:first"),g=b.height(),b=d.height(),a=b+(a.height()-g)-15;c.is(".youi-dialog-content")&&(a-=c.find(".form-buttons:last").height(),a-=2);b!=a&&a>(this.options.scrollHeight|220)&&(d.height(a),this.element.find(".grid-x-scroll").addClass("adapter-autoHeight"))}}},_initVar:function(){this.cols=[];this.fixedWidth=this.fixedCount=0;this.gridWidth=this._calGridWidth();this._setPageIndex(1);this.buttonActions=[];this.cachedData=[];this.cachedRowIndex=0;this._initNumCol();
this._initCheckboxCol();this._initRadioCol();for(var b=[],c=0;c<this.options.cols.length;c++){var d=a.extend({width:100},this.options.cols[c]);d.fixed==true?(this.fixedCount++,this.cols.push(d)):b.push(d)}this.cols=this.cols.concat(b);this.options.fixed==false?this.fixedCount=0:this.fixedWidth=this._getFixedWidth(this.cols);this.contentWidth=this.gridWidth-this.fixedWidth-20;this._initBtnVar()},_initBtnVar:function(){this.buttonActions=this.options.buttonActions||[];this.buttonActions.add&&(this.buttonActions.add=
function(){a(this).parents(".youi-grid:first").grid("openFormAdd")});this.buttonActions.edit&&(this.buttonActions.edit=function(){a(this).parents(".youi-grid:first").grid("openFormEdit",a(this).text())});this.buttonActions.remove&&(this.buttonActions.remove=function(){a(this).parents(".youi-grid:first").grid("removeRecords")});this.buttonActions.exportXls&&(this.buttonActions.exportXls=function(){a(this).parents(".youi-grid:first").grid("exportXls")})},_bindDataForm:function(){if(this.options.dataFormId){var b=
this;a("#"+this.options.dataFormId).bind("form.afterSubmit",function(){var c=a(this).form("getFormRecord");a(this).form("close");b.fillQueryParams(c);b.pReload()})}},openFormAdd:function(){if(this.options.dataFormId){var b=a("#"+this.options.dataFormId);b.form("fieldReset").form("open",a.youi.resourceUtils.get("grid.add"),1);if(this.options.parentId&&this.options.parentAttr){var c={};c[this.options.parentAttr]=a("#"+this.options.parentId).grid("getSelectedRecord");b.form("fillRecord",c)}}},openFormEdit:function(b){if(this.options.dataFormId&&
this.options.editSrc){var c=this.getSelectedRow();c&&(c=e(c[0],this.options.editSrc,this.options.idKeys),a("#"+this.options.dataFormId).form("find",c,window[this.options.dataFormId+"_afterFind"]).form("open","["+a.trim(b||a.youi.resourceUtils.get("grid.edit"))+"]",2))}},removeRecords:function(){var b=[],c=this.options.idKeys,d=this._getSelectedRows();d.each(function(){b=b.concat(f(this,c,""))});window.confirm(a.youi.resourceUtils.get("grid.confirm.remove",d.length))&&a.youi.ajaxUtil.ajax({url:this.options.removeSrc,
data:b.join("&"),widgetId:this.options.id,success:function(){a("#"+this.widgetId).grid("pReload")}})},_calGridWidth:function(){if(this.element.is(":visible")){if(!this.options.width||this.options.width==0){var a=this.element.parent().width();if(a==0)var a=this.element.offsetParent(),b=Math.abs(a.innerWidth()-a.width()),a=a.width()-b;this.width=a}else this.width=this.options.width;return this.width}else return 0},_getFixedWidth:function(a){for(var b=0,c=null,d=0;d<a.length;d++)c=a[d],c.fixed==true&&
(b+=c.width||80);return b},_initNumCol:function(){this.options.showNum&&(this.cols.push({property:"num",type:"num",fixed:true,caption:"",align:"center",width:this.options.numWidth}),this.fixedCount++)},_initCheckboxCol:function(){this.options.showCheckbox&&(this.cols.push({property:"checkbox",type:"checkbox",caption:'<span class="youi-icon checkbox selected-all"/>',fixed:true,align:"center",width:this.options.checkboxWidth}),this.fixedCount++)},_initRadioCol:function(){this.options.showCheckbox!=
true&&this.options.showRadio==true&&(this.cols.push({property:"radio",type:"radio",caption:"",fixed:true,align:"center",width:this.options.checkboxWidth}),this.fixedCount++)},_calFixedWidth:function(){},_defaultHtmls:function(){if(this.options.initHtml==true){var a=[];a.push('<div class="grid-query"></div>');a.push(this._buildHeaderHtml());a.push('<div class="grid-content">');a.push('\t<table cellpadding="0" cellspacing="0">');a.push("\t\t<tr>");a.push('\t\t\t<td valign="top"><div class="grid-fixed"></div></td>');
a.push('\t\t\t<td valign="top" class="grid-content-td"><div style="width:'+this.contentWidth+'px;" class="grid-scroll grid-width-resize"></div></td>');a.push("\t\t</tr>");a.push("\t</table>");a.push("</div>");a.push('<div style="width:'+this.contentWidth+'px;"  class="grid-x-scroll grid-width-resize"><div class="grid-scroll-width"></div></div>');a.push(this._buildFooterHtml());this.element.html(a.join(""))}},_fixedXScroll:function(){var a=this.element.find(".grid-scroll:first>table").width(),b=this.element.find(".grid-x-scroll");
this.element.find(".grid-content .grid-scroll:first").width()<a-5?(b.css("paddingLeft",this.fixedWidth),b.find(">div").width(a),b.addClass("scroll-active")):(b.removeClass("scroll-active"),b.find(">div").width(1))},_fixedYScroll:function(){var a=this.element.find(">.grid-content")[0];a.scrollTop=1;a.scrollTop==0?this.element.find(".grid-scroll").width(this.contentWidth+17):this.element.find(".grid-scroll").width(this.contentWidth)},_buildHeaderHtml:function(){for(var a=['<div class="grid-header">'],
b=['<table width="'+this.fixedWidth+'px" class="header-table" cellpadding="0" cellspacing="1"><tr class="row-width-contral">'],c=['<table class="header-table" cellpadding="0" cellspacing="1" width="1" ><tr class="row-width-contral">'],d,g=0;g<this.cols.length;g++)d=this.cols[g],d.fixed==true?b.push('<td style="width:'+d.width+'px;" class="col-width"></td>'):c.push('<td style="width:'+d.width+'px;" class="col-width"></td>');b.push("</tr><tr>");c.push("</tr><tr>");for(g=0;g<this.cols.length;g++)d=this.cols[g],
d.fixed==true?b.push('<th class="header-cell '+d.property+'">'+d.caption+"</th>"):(c.push('<th class="col-resize header-cell '+d.property+'">'+d.caption),c.push('<div class="header-handler"><div class="toggle-handler"></div><div class="resize-handler"></div></div>'),c.push("</th>"));b.push("</tr></table>");a.push('<table cellpadding="0" cellspacing="0"><tr>');a.push('<td><div class="grid-fixed">');a=a.concat(b);a.push("</div></td>");c.push("</tr></table>");a.push('<td><div style="width:'+this.contentWidth+
'px;" class="grid-scroll grid-width-resize">');a=a.concat(c);a.push("</div></div></div></div></td>");a.push("</tr></table></div>");return a.join("")},_buildFooterHtml:function(){var a=[];a.push('<div class="grid-footer"><div class="grid-navigator">');a.push('<div class="pGroup"> ');a.push('<div class="first"><div class="pFirst pButton disabled"></div></div>');a.push('<div class="prev"><div class="pPrev pButton disabled"></div></div> ');a.push("</div> ");a.push('<div class="btnseparator"></div> ');
a.push('<div class="pGroup"><span class="pcontrol"><input class="pageIndex" type="text" style="width:30px;" value="" /></span></div> ');a.push('<div class="btnseparator"></div> ');a.push('<div class="pGroup"> ');a.push('<div class="next"><div class="pNext pButton disabled"></div></div>');a.push('<div class="last"><div class="pLast pButton disabled"></div></div>');a.push("</div>");a.push('<div class="btnseparator"></div>');a.push('<div class="pGroup"><div class="pReload pButton"></div></div>');a.push('<div class="btnseparator"></div> ');
a.push('<div class="pGroup"><span class="pPageStat">');a.push("</span>");a.push("</div>");a.push("</div></div>");return a.join("")},_mouseStart:function(b){var c=a(b.target);this.scrollLeft=this.element.find(".grid-header .grid-scroll")[0].scrollLeft;if(c.hasClass("resize-handler"))this.currentDrag=c,b=c.parent().parent(),this.targetLeft=b.position().left,c=this.element.find("#col-resize-helper"),c.length==0&&(c=a('<div class="col-resize-helper" id="col-resize-helper"></div>').appendTo(this.element)),
this.helper=c.addClass("resizing").css({top:b.position().top,left:this.targetLeft,width:b.width(),height:this.element.find(".grid-content").height()+this.element.find(".grid-header").height()});else if(c.hasClass("col-resize"))this.currentDrag=c,this.helper=this._createHelper(b,a("<span>"+this.currentDrag.text()+"</span>"));else if(c.hasClass("grid-tree-node"))this.currentDrag=c,this.helper=this._createHelper(b,this.currentDrag.find(">span:last"))},_mouseDrag:function(b){if(this.currentDrag)if(this.currentDrag.hasClass("resize-handler")){if(this.helper)this.position=
this._generatePosition(b),b=this.position.left-this.targetLeft,b>10&&this.helper.width(b)}else if(this.currentDrag.hasClass("grid-tree-node")){this.position=this._generatePosition(b);this.helper.css(this.position);var c=a(b.target);c.hasClass("grid-tree-node")&&this._doDrag(c)}else if(this.currentDrag.hasClass("col-resize"))if(this.position=this._generatePosition(b),this.helper.css(this.position),c=a(b.target),c.hasClass("col-resize")){var d=c[0].offsetLeft,b=c.width();this.comparePosition=d+b/2-
this.scrollLeft;this.insertPosition=this.position.left;this._doDrag(c);this.comparePosition>this.insertPosition?c.addClass("insert-before").removeClass("insert-after"):c.addClass("insert-after").removeClass("insert-before")}else this.insertPosition=null;else this._releaseDrop()},_mouseStop:function(){if(this.currentDrag)if(this.currentDrag.hasClass("resize-handler"))this._resizeColWidth(this.currentDrag.parent().parent(),this.helper.width());else if(this.currentDrag.hasClass("grid-tree-node"))this._dropOut(),
this.helper.remove(),this.position=null,this._moveTreeNode(this.currentDrag.parent(),this.currentDrop.parent()),acceptHelper=null;else if(this.currentDrag.hasClass("col-resize"))this._dropOut(),this.helper.remove(),this.position=null,this._moveCol(this.currentDrag,this.currentDrop,this.insertPosition,this.comparePosition),this.currentDrop.removeClass("insert-before").removeClass("insert-after"),acceptHelper=this.insertPosition=this.comparePosition=null;this.helper&&this.helper.removeClass("resizing");
this.scrollLeft=this.helper=this.currentDrop=this.currentDrag=null},_moveCol:function(b,c,d,g){if(d!=null){var i=c.prevAll().length,e=b.prevAll().length,f=Math.min(i,e)+this.fixedCount,h=Math.max(i,e)+this.fixedCount,k=this.cols.slice(0,f),j=this.cols.slice(f+1,h),m=this.cols.slice(h+1),k=[].concat(k);if(g>d){if(c.prev().length&&c.prev()[0]==b[0])return;c.before(b);this.element.find(".grid-content .grid-scroll tr.row").each(function(){a(this.cells[i]).before(a(this.cells[e]))});i>e?(k=k.concat(j),
k.push(this.cols[f]),k.push(this.cols[h])):(k.push(this.cols[h]),k.push(this.cols[f]),k=k.concat(j))}else{if(c.next().length&&c.next()[0]==b[0])return;c.after(b);this.element.find(".grid-content .grid-scroll tr.row").each(function(){a(this.cells[i]).after(a(this.cells[e]))});i>e?(k=k.concat(j),k.push(this.cols[h]),k.push(this.cols[f])):(k.push(this.cols[h]),k.push(this.cols[f]),k=k.concat(j))}this.cols=k=k.concat(m)}},_resizeColWidth:function(b,c){var d=b.width();if(c-d!=0){this.element.width(this.element.width());
var i=b.prevAll().length;this.element.find(".grid-header .grid-scroll .col-width").each(function(b){b==i?a(this).width(c):a(this).width(this.offsetWidth)});this.element.find(".grid-content .grid-scroll .col-width").each(function(b){b==i?a(this).width(c):a(this).width(this.offsetWidth)});this.gridWidth=this.element.width();this.contentWidth=this.gridWidth-this.fixedWidth-20;this._fixedXScroll();g()}},parseRecords:function(c,d){var g=this.options.id,i=a.youi.recordUtils.records2Htmls(c,{cols:this.cols,
idKeys:this.options.idKeys,fixedCount:this.fixedCount,hasTreeCol:this.options.hasTreeCol,parseRecord:function(a,c){return b(g,c,this.cols,this.idKeys,a,false,this.fixedCount,this.hasTreeCol)},parse:function(a,b){return[b[0].join(""),b[1].join("")]}}),e=[],f=[];e.push('<table width="1" class="data-table" cellpadding="0" cellspacing="1">');e.push('<tr class="row-width-contral">');e.push(this.element.find(">.grid-header .grid-scroll tr.row-width-contral").html());e.push("</tr>");e.push(i[0]);e.push("</table>");
this.fixedCount&&(f.push('<table width="'+this.fixedWidth+'px" class="data-table" cellpadding="0" cellspacing="1">'),f.push('<tr class="row-width-contral">'),f.push(this.element.find(">.grid-header .grid-fixed tr.row-width-contral").html()),f.push("</tr>"),f.push(i[1]),f.push("</table>"));this.element.find(">.grid-content .grid-scroll:first").html(e.join(""));this.element.find(">.grid-content .grid-fixed:first").html(f.join(""));this._activePager(d);this._fixedYScroll();j(this.element);i=this.element.find(".grid-scroll .data-table tr.row:first");
i.length?this._selectedRow(null,i):this.element.trigger("grid.loadByParent");this._autoHeight();a.isFunction(window[this.options.id+"_afterParse"])&&window[this.options.id+"_afterParse"].apply(this.element[0],[c])},_ajaxDatas:function(){if(this.options.src&&(g(),!(a.isFunction(window[this.options.id+"_beforeSubmit"])&&window[this.options.id+"_beforeSubmit"].apply(this.element[0])==false))){var b=this._getParams();if(this.options.parentId){var c=a("#"+this.options.parentId);if(c.length)if(c=c.grid("getSelectedKeyParams",
this.options.parentAttr),a.isArray(c)&&c.length>0)b=b.concat(c);else{this.element.find(">.grid-content .grid-scroll:first,>.grid-content .grid-fixed:first").empty();j(this.element);return}}var d="#"+this.options.id+" .pReload.pButton";a(d).addClass("loading");a.youi.ajaxUtil.ajax({url:this.options.src,dataType:this.options.srcType,data:b.join("&"),type:"post",id:this.element.attr("id"),success:function(b){var c;c=b.records;b=b.totalCount;a("#"+this.id).grid("parseRecords",c,b);a(d).removeClass("loading")}})}},
goPage:function(a){a<1&&(a=1);if(this.pageCount>0&&a>this.pageCount)a=this.pageCount;this.pageCount==1&&this.element.find("input.pageIndex").val(1);this.currentPageIndex!=a&&(this._setPageIndex(a),this._ajaxDatas())},_setPageIndex:function(a){this.currentPageIndex=parseInt(a)},_getParams:function(){var b=[],b=b.concat(this._getPagerParams()),b=b.concat(this._getQueryParams()),b=b.concat(this._getSortParams());a.isArray(this.parentParams)&&(b=b.concat(this.parentParams));return b},_getQueryParams:function(){var b=
[];if(this.element.find(".youi-fieldLayout").length==0)return b;var c=[];this.element.find(".youi-fieldLayout").each(function(){var d=a(this).fieldLayout("getFieldValues");a.isArray(d)&&(c=c.concat(d));a(this).find(".youi-field").each(function(){var a=this.getAttribute("operator"),c=this.getAttribute("property");a&&b.push("operator:"+c+"="+a)})});c&&a(c).each(function(){this.value&&b.push(a.youi.parameterUtils.propertyParameter(this.property,this.value))});return b},fillQueryParams:function(b){this.element.find(".youi-fieldLayout").each(function(){a(this).fieldLayout("setFieldValues",
b)})},_getSortParams:function(){var a=[],b=this.cols.length,c;if(this.element.find("th.sort").length==0)return a;c=this.element.find("th.sort.sorting");var d=0;if(c.length)d=c.prevAll().length;(c=h(this.cols[d]))&&a.push(c);for(var g=0;g<b;g++)g!=d&&(c=this.cols[g],c.orderBy&&a.push(h(c)));return a},_getPagerParams:function(){var a=[];a.push("pager:pageIndex="+this.currentPageIndex);a.push("pager:pageSize="+this.options.pageSize);var b=[],c={};if(this.options.idKeys)for(var b=this.options.idKeys.split(","),
d,g=0;g<b.length;g++)if(d=b[g])a.push("pager:property="+d),c[d]=true;for(g=0;g<this.options.cols.length;g++)c[this.options.cols[g].property]!=true&&a.push("pager:property="+this.options.cols[g].property);return a},_initAction:function(){var b=this.widgetName;a.youi.buttonUtils.addButtonActionListener(this.element.find(".grid-formButtons:first"),{submit:function(){a(this).parents(".youi-grid:first").grid("submit")},reset:function(){a(this).parents(".youi-grid:first").grid("reset")}});a.youi.buttonUtils.addButtonActionListener(this.element.find(".grid-buttons"),
this.buttonActions);this.element.delegate(".youi-fieldLayout input.textInput","keydown",function(b){if(b.keyCode==13)return a(b.delegateTarget).grid("pReload"),false});this.element.find(">.grid-content").editor({}).delegate(".cell","click",function(c){var d=a.youi.getWidget(c.delegateTarget.parentNode,b);g();d._clickCell(c,this,c.delegateTarget);d._selectedRow(c,this.parentNode);return false}).delegate(".tree-toggle-handler","click",function(c){a.youi.getWidget(c.delegateTarget.parentNode,b).toggleTreeNode(c,
this.parentNode.parentNode)});this.element.find(".grid-x-scroll").scroll(function(){a(this).parents(".youi-grid:first").find(".grid-scroll").scrollLeft(this.scrollLeft);g()});this.element.find(">.grid-header").delegate(".header-cell.checkbox","click",function(c){var d=a(this.parentNode.parentNode);d.toggleClass("selected");a.youi.getWidget(c.delegateTarget.parentNode,b).toggleSelectedAll(d.is(".selected"))}).delegate(".header-cell","mouseenter",function(b){var c=a(this),d=a(".grid-scroll:first",b.delegateTarget);
c.addClass("header-cell-over");c=a(".grid-fixed:first",b.delegateTarget).width();a(">.header-handler",this).css({top:b.delegateTarget.offsetTop,left:this.offsetLeft+this.offsetWidth-19-d[0].scrollLeft+c,height:this.offsetHeight})}).delegate(".header-cell","mouseleave",function(){a(this).removeClass("header-cell-over").removeClass("insert-after").removeClass("insert-before")}).delegate(".header-cell.sort","click",function(){var b=a(this);b.parents(".youi-grid:first").grid("sorting",b)});this.element.find(".grid-navigator").delegate(".pButton",
"click",function(b){var c=this.className;c.indexOf(" disabled")==-1&&(c=c.split(" ")[0],a(b.delegateTarget).parents(".youi-grid:first").grid(c))});this.element.find(".grid-content").bind("scroll",function(){g()});a("body",document).bind("body.resize",{ui:this.element},function(a){try{a.data.ui.grid("resize")}catch(b){}})},sorting:function(a){var b;b=a.hasClass("desc")?"asc":"desc";a.removeClass("asc").removeClass("desc");a.parent().find(".sorting").removeClass(".sorting");a.addClass("sorting").addClass(b);
if(a=this.cols[a.prevAll().length+this.fixedCount])a.orderBy=b;this.refresh()},toggleTreeNode:function(b,c){var d=a(c);d.hasClass("expandable")&&(d.is(".expanded")?this._closeTreeNode(d):this._openTreeNode(d))},_openTreeNode:function(a){a.addClass("expanded");var b=a.next();if(b.length){var c=i(a[0]),d=i(b[0]);if(c>=d)a.removeClass("expandable");else for(;b.length&&!b.hasClass("show");)a=b,c=i(a[0]),d==c&&a.addClass("show"),b=a.next(),i(b[0])>c&&a.addClass("expandable").removeClass("expanded")}else a.removeClass("expandable")},
_closeTreeNode:function(a){a.removeClass("expanded");for(var b=a.next(),a=i(a[0]);b&&b.length;){var c=b,d=i(c[0]),b=b.next();d<=a?b=null:c.removeClass("show")}},visitorTree:function(a,b){var c=i(a[0]),d=a.next();for(b.apply(a[0]);d&&d.length;){var g=d,e=i(g[0]),d=d.next();e<=c?d=null:b.apply(g[0])}},_moveTreeNode:function(b,c){var d=true;this.visitorTree(b,function(){if(c[0]==this)return d=false});if(d){this._openTreeNode(c);var g=a("<tr/>").insertAfter(c),e=i(c[0]),f=i(b[0]),h=k(e)+1-k(f);this.visitorTree(b,
function(){var b=i(this),c=k(b),d=c+h;c!=d&&a(this).removeClass(b).addClass("tree-level-"+d);g.before(this)});c.addClass("expandable");g.remove();g=null}},toggleSelectedAll:function(b){var c=this._getSelectedRows();b==true?a(".row",this.element).addClass("selected"):a(".row",this.element).removeClass("selected");this._selectedChanged(c)},_getSelectedRows:function(){return this.element.find(".grid-content .grid-scroll .row.selected")},getSelectedKeys:function(){var a=[];this.element.find(".grid-content .grid-scroll .row.selected").each(function(){a.push(this.getAttribute("id"))});
return a},getSelectedRow:function(){var a=this.element.find(".grid-content .grid-scroll .row.selected:first");return a.length?a:null},getSelectedRecord:function(){var a={},b=this.getSelectedRow();return b?this._getRecordFromRow(b[0]):a},_selectedChanged:function(b){this.element.trigger("grid.loadByParent");var c=this.options.id+"_select";a.isFunction(window[c])&&window[c].apply(this.element[0],[b]);j(this.element)},_bindParentGrid:function(){if(this.options.parentId){var b=this,c=a("#"+this.options.parentId);
c.length&&c.bind("grid.loadByParent",function(){window.setTimeout(function(){b._ajaxDatas()})})}},getSelectedKeyParams:function(a){var b=[],c=this.getSelectedRow();if(c){var d;a&&(d=a+".");a=e(c[0],"",this.options.idKeys,d);b.push(a.substring(1))}return b},_clickCell:function(b,c,d){var g=false;if(b.target.className.indexOf(" editable")!=-1){var b=a(c),c=b.prevAll().length+this.fixedCount,g=this.cols[c],i=","+this.options.idKeys+",";if(!b.parent().hasClass("row-new")&&i.indexOf(","+g.property+",")!=
-1)return false;c=a.extend({name:g.editor,type:g.editor,rowIndex:b.parent().prevAll().length,colIndex:c+1,record:{}},g,{initHtml:true},g.editorOptions);a(d).trigger("editor.open",[b,c]);g=true}return g},_selectedRow:function(b,c){if(c){var d=a(c),g=d.prevAll().length,i=this.getSelectedKeys(),e=this.element.find(".grid-fixed .data-table tr:eq("+g+")"),g=this.element.find(".grid-scroll .data-table tr:eq("+g+")");(this.options.showCheckbox!=true||b&&!b.ctrlKey)&&this.element.find("tr.selected").not(e).not(g).removeClass("selected");
e.toggleClass("selected");g.toggleClass("selected");d.hasClass("selected")&&this._getRecordFromRow(g[0]);d=this.getSelectedKeys();i.sort();d.sort();i.join()!=d.join()&&this._selectedChanged()}},_activePager:function(b){if(b){var c=this.currentPageIndex,d=this.options.pageSize,g=Math.ceil(b/d);this.pageCount=g;if(c>g)this.currentPageIndex=c,c=g;g<2?this._disableFunButtons(["pFirst","pPrev","pNext","pLast"]):c==1?(this._activeFunButtons(["pNext","pLast"]),this._disableFunButtons(["pFirst","pPrev"])):
c==g?(this._activeFunButtons(["pFirst","pPrev"]),this._disableFunButtons(["pNext","pLast"])):this._activeFunButtons(["pFirst","pPrev","pNext","pLast"]);var i=c*d;i>b&&(i=b);b=a.youi.resourceUtils.get("grid.pagestat",c,g,b,(c-1)*d+1,i);this.element.find(".pPageStat").html(b);this.element.find("input.pageIndex").val(c)}else this.element.find(".pPageStat").html(a.youi.resourceUtils.get("grid.notFound")),this.element.find("input.pageIndex").val(""),this._disableFunButtons(["pFirst","pPrev","pNext","pLast"])},
_activeFunButtons:function(a){this.element.find(".pButton."+a.join(",.pButton.")).removeClass("disabled")},_disableFunButtons:function(a){this.element.find(".pButton."+a.join(",.pButton.")).addClass("disabled")},pFirst:function(){this.goPage(1)},pPrev:function(){this.goPage(this.currentPageIndex-1)},pNext:function(){this.goPage(this.currentPageIndex+1)},pLast:function(){this.goPage(this.pageCount)},pReload:function(){this._ajaxDatas()},refresh:function(){this.pReload()},pAddRow:function(){this.addRow({},
this.options.hasTreeCol)},pRemoveRow:function(){this.element.find(".grid-content .data-table .row.selected").remove()},submit:function(){this.currentPageIndex=1;if(this.validate())this._ajaxDatas();else{var a=[];this.element.find(".youi-field.validating,.youi-field.validate-error").each(function(){this.title&&a.push(this.title)})}},submitAction:function(b,c,d,g){if(!c||window.confirm(c)){var i=[],e=this.options.idKeys;if("2"==g&&e)this._getSelectedRows().each(function(){i=i.concat(f(this,e,""))});
else{c=this.getSelectedRecord();c=a.youi.recordUtils.recordToParameters(c);for(g=0;g<c.length;g++)i.push(a.youi.parameterUtils.propertyParameter(c[g].property,c[g].value))}if(b&&i.length){var h=this;a.youi.ajaxUtil.ajax({url:b,data:i.join("&"),success:function(b){a.isFunction(d)?d.apply(this,[b]):h.pReload()}})}}},reset:function(){this.element.find(".youi-fieldLayout .youi-field").fieldReset()},validate:function(){var a=this.element.find(".youi-fieldLayout");a.find(".youi-field").fieldValidate();
return a.find(".youi-field.validating,.youi-field.validate-error").length==0?true:false},show:function(){},setSelectedRecords:function(){},getRecords:function(a){var b=[],c=this;(a==true?this.element.find(">.grid-content .grid-scroll tr.row.selected"):this.element.find(">.grid-content .grid-scroll tr.row")).each(function(){b.push(c._getRecordFromRow(this))});return b},_getRecordFromRow:function(b){var c=b.getAttribute("id"),d=m({},this.options.idKeys,c),g=a.grep(this.cols,function(a){return!a.fixed});
a("td",b).each(function(b){var b=g[b],c;b&&b.property&&!b.fixed&&(c=this.getAttribute("value")||this.textContent||this.innerText||a("input",this).val())&&(d[b.property]=c)});if(b=i(b))d.level=k(b);return d},resize:function(){if(this.element.is(":visible")){this.width=this._calGridWidth();var a=this.width-this.fixedWidth-2;if(this.contentWidth<=0||a!=this.contentWidth)this.contentWidth=a,this.element.width(this.width-2),this.element.find(".grid-width-resize").width(a),this._fixedXScroll(),g();this._autoFull();
this._autoHeight()}},addRow:function(c,d){var g=this.element.find(".grid-content .grid-scroll:first tr.row").length,g=b(this.options.id,c,this.cols,this.options.idKeys,g,true,this.fixedCount,d),i=this.element.find(">.grid-content .grid-scroll:first table tbody");i.length?(i.append(g[0]),g.length>1&&this.element.find(">.grid-content .grid-fixed:first table tbody").append(g[1]),this.options.showNum===true&&this.element.find(">.grid-content .grid-fixed .cell.num").each(function(b){a(this).text(b+1)})):
this.parseRecords([c],1)},exportPrint:function(){this._exportRecords("print")},exportXls:function(){this._exportRecords("xls")},exportTxt:function(){this._exportRecords("txt")},exportPdf:function(){this._exportRecords("pdf")},_exportRecords:function(b){if(this.options.src){var c=a("#"+this.options.id+"_exportHelper");if(!c.length){var c=[],d=a("#"+this.options.parentId);d.length&&(d=d.grid("getSelectedKeyParams",this.options.parentAttr),a.isArray(d)&&d.length>0&&(c=c.concat(d)));c=this.options.src+
(this.options.src.indexOf("?")==-1?"?":"&")+c.join("&");c=a('<form target="_blank" method="post" action="'+c+'"> </form>').appendTo("body",document)}c.html(this._getExportFormHtmls(b));c.submit()}},_getExportFormHtmls:function(b){var c=[],d=this.options.maxExportSize;if(this.element.find(".youi-fieldLayout").length){var g=this.element.find(".youi-fieldLayout").fieldLayout("getFieldValues");g&&a(g).each(function(){this.value&&c.push('<input name="'+this.property+'" value="'+encodeURIComponent(this.value)+
'" type="hidden"/>')})}c.push('<input name="pager:export" value="'+b+'" type="hidden"/>');c.push('<input name="pager:pageIndex" value="1" type="hidden"/>');c.push('<input name="pager:pageSize" value="'+d+'" type="hidden"/>');c.push('<input name="pager:exportTitle" value="'+encodeURIComponent(this.options.exportTitle)+'" type="hidden"/>');for(var b=this.cols.length,i=0;i<b;i++)d=this.cols[i],g=d.property,g!="checkbox"&&g!="num"&&(c.push('<input name="pager:header" value="'+d.caption+'" type="hidden"/>'),
c.push('<input name="pager:property" value="'+d.property+'" type="hidden"/>'));return c.join("")},loadByParents:function(a){this.parentParams=a;this.refresh()},destroy:function(){this.element.removeClass("youi-grid");a.Widget.prototype.destroy.apply(this,arguments)}}))})(jQuery);(function(a){a.widget("youi.mousable",a.ui.mouse,{_create:function(){this.element.disableSelection();this._mouseInit()},_mouseStart:function(a){if(!this._trigger("start",a))return false},_mouseDrag:function(a){this._trigger("drag",a)},_mouseStop:function(a){this._trigger("stop",a)},_mouseCapture:function(){return true}});a.extend(a.youi.mousable,{defaults:{delay:0,distance:1}})})(jQuery);(function(a){a.widget("youi.page",a.extend({},a.ui.mouse,{options:{},dialogs:[],_create:function(){this.options.pageId=this.options.pageId||this.element.attr("id");this.element.addClass("youi-page");this.dialogs=[]},addDialog:function(a){this.dialogs.push(a)},destroy:function(){a("script#script_"+this.options.pageId).remove();this.element.removeClass("youi-page");a.Widget.prototype.destroy.apply(this,arguments);a.each(this.dialogs,function(){this.remove()})}}));a.extend(a.youi.dialog,{version:"1.0.0"})})(jQuery);(function(a){a.youi&&a.youi.resource&&a.extend(a.youi.resource,{loading:"\u6570\u636e\u8bfb\u53d6\u4e2d\uff0c\u8bf7\u7a0d\u5019...",urlNotFound:a.youi.getMessage("\u5730\u5740\u3010{0}\u3011\u8bbf\u95ee\u5f02\u5e38!"),close:"\u5173\u95ed","grid.add":"\u589e\u52a0","grid.notFound":"\u672a\u627e\u5230\u8bb0\u5f55.","grid.edit":"\u4fee\u6539","grid.remove":"\u5220\u9664","grid.pagestat":a.youi.getMessage("{0}/{1}\u9875,{2}\u6761,\u663e\u793a{3}-{4}."),"grid.confirm.remove":a.youi.getMessage("\u786e\u8ba4\u5220\u9664\u9009\u4e2d\u7684{0}\u6761\u8bb0\u5f55?"),
"grid.noSelectMsg":"\u8bf7\u9009\u62e9\u4e00\u6761\u8bb0\u5f55","grid.confirm.reload.notSubmit":"\u5237\u65b0\u8868\u683c\u4f1a\u4e22\u5931\u672a\u63d0\u4ea4\u7684\u6570\u636e,\u662f\u5426\u7ee7\u7eed?","grid.records.notFount":"\u672a\u627e\u5230\u8bb0\u5f55!","grid.editor.errorMessage":a.youi.getMessage("\u7b2c{0}\u884c\uff0c\u7b2c{1}\u5217\uff1a{2}."),"tabs.maxOpenTab":a.youi.getMessage("\u6700\u5927\u5141\u8bb8\u6253\u5f00{0}\u4e2a\u6807\u7b7e."),"tabs.close":"\u5173\u95ed\u9875\u9762","form.invalid":a.youi.getMessage("\u6821\u9a8c\u63d0\u793a\uff1a{0}."),
error:"\u5f02\u5e38"})})(jQuery);(function(a){function b(b,d){a(window).resize();var e=window["P_"+b+"_subpage_init"];a.isFunction(e)&&e(d)}a.widget("youi.subpage",{options:{type:"dialog",width:1E3,height:300},_create:function(){this.element.addClass("youi-subpage").height(this.options.height);this._initAction();this.options.formAction&&this.element.addClass("youi-form").form({id:this.options.id,initHtml:false})},_initAction:function(){var b=this.element.find(">.subpage-buttons");if(this.options.buttonActions){var d=a.extend({},
this.options.buttonActions),e=this.element;d.close&&(d.close=function(){e.subpage("close")});d.submit&&(d.submit=function(){e.subpage("submit")});a.youi.buttonUtils.addButtonActionListener(b,d)}},open:function(a,b,e){this.openParams=e;switch(this.options.type){case "dialog":this._openDialog(a,b,e);break;case "window":this._openWindow(a,e)}},submit:function(){var a=this.options.formAction;if(a){if(this.openParams)for(var b in this.openParams)a=a.replace(RegExp("\\{"+b+"\\}","g"),this.openParams[b]);
this.element.attr("action",a);this.element.form("submit")}},_loadSubPage:function(c,d){var e=this.options.subpageId;if(d||!this.element.hasClass("loaded")){var f=this.element.find(">.subpage-content");f.empty();var h=this._getSubpageUrl(),g;for(g in d)h=h.replace(RegExp("\\{"+g+"\\}","g"),d[g]);a.youi.pageUtils.loadPage(f,h,function(){a(this.parentNode).addClass("loaded");window.setTimeout(function(){b(e,c)},100)})}else b(e,c)},_openDialog:function(a,b,e){this._loadSubPage(a,e);this.element.dialog({autoOpen:false,
width:(parseInt(this.options.width)||600)+28,title:this.options.caption,modal:true,minHeight:500,overlay:{opacity:0.2,background:"#A8A8A8"},close:function(){return true}}).show().dialog("open",b)},_openWindow:function(b){a.youi.pageUtils.goPage(this._getSubpageUrl(),b)},_getSubpageUrl:function(){return a.youi.parameterUtils.connectParameter(this.options.src,"page:pageId",this.options.subpageId)},close:function(){switch(this.options.type){case "dialog":this.element.dialog("close")}this.openParams=
null},destroy:function(){a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);(function(a){a.widget("youi.tabs",{options:{showClose:true,maxOpenTab:10},_create:function(){this.element.addClass("youi-tabs");this.options.id=this.element.attr("id");var a=this.element.find(">.tabs-header:first");a.prepend('<div class="tabs-trigger"/>');this.element.prepend(a);this.options.itemHeight&&this.element.height(parseInt(this.options.itemHeight)+28);this._initVar();this._initAction();this.selectIndex(0)},_initVar:function(){this.tabs={}},_initAction:function(){var b=this.widgetName;this.element.find(">.tabs-header").delegate(".tabs-item",
"click",function(c){var e=this.getAttribute("id");a.youi.getWidget(c.delegateTarget.parentNode,b).selectTab(e)}).delegate(".close","click",function(c){var e=this.parentNode.parentNode.getAttribute("id");a.youi.getWidget(c.delegateTarget.parentNode,b).closeTab(e);return false}).delegate(".tabs-trigger","click",function(c){a.youi.getWidget(c.delegateTarget.parentNode,b).openSelection();return false});this.element.delegate(">.tabs-selection:first .tabs-item","click",function(c){var e=this.getAttribute("id");
a.youi.getWidget(c.delegateTarget,b).selectTab(e);a(">.tabs-selection",c.delegateTarget).hide();return false});a("body",document).bind("body.resize",{ui:this.element},function(a){try{a.data.ui.tabs("resize")}catch(b){}});var c=this;a("body",document).bind("click",function(){c.closeSelection()})},closeSelection:function(){this.element.find(">.tabs-selection:first").hide()},openSelection:function(){this.element.css("position","relative");var b=this.element.find(">.tabs-selection:first");b.length==0&&
(b=a('<div class="tabs-selection"></div>').appendTo(this.element));b.empty().append(this.element.find(">.tabs-header ul").clone());b.show().css({zIndex:100,left:0,top:25})},loadPage:function(b,c,d,e){var f=this.options.maxOpenTab,b="tab_"+b;if(this.tabs[b])f=this.tabs[b];else{if(this.element.find(">.tabs-header .tabs-item").length==f){alert(""+a.youi.resourceUtils.get("tabs.maxOpenTab",f));return}f=b+"_panel";this.addTab(b,d,function(b){a.youi.pageUtils.loadPage(b,c,e)});this.tabs[b]=f}this.selectTab(b)},
addItemPage:function(a,c){this.addTab(a,c)},selectTab:function(b){if(!a.isFunction(window[this.options.id+"_beforeSelect"])||window[this.options.id+"_beforeSelect"](b)){var c=b+"_panel",d=this.element.find(">.tabs-header .tabs-item#"+b),c=this.element.find(">.tabs-panel#"+c);this.element.find(">.active,>.tabs-header .active").removeClass("active");d.addClass("active");c.addClass("active");this.options.itemSrc&&!c.hasClass("loaded")&&(d=a.youi.parameterUtils.connectParameter(this.options.itemSrc,"id",
b),d=a.youi.parameterUtils.connectParameter(d,"page:pageId",b),a.youi.pageUtils.loadPage(c,d,function(){a(this).addClass("loaded")}));a("body",document).trigger("body.resize");this._adjustScrollLeft();if(a.isFunction(window[this.options.id+"_select"]))window[this.options.id+"_select"](b)}},selectIndex:function(){this.selectTab(this.element.find(">.tabs-header .tabs-item:first").attr("id"))},closeTab:function(a){var c=this.tabs[a],d=this.element.find(">.tabs-header .tabs-item#"+a),e;e=d.prev();e=e.length?
e.attr("id"):d.next().attr("id");d.remove();this.element.find(">.tabs-panel#"+c).remove();delete this.tabs[a];e&&this.selectTab(e)},addTab:function(b,c,d){var e="",f=b+"_panel";this.options.showClose&&(e='<a class="youi-icon close" title="'+a.youi.resourceUtils.get("tabs.close")+'"></a>');this.element.find(".tabs-header:first>ul").append('<li class="tabs-item" id="'+b+'"><span><a href="javascript:void(0);">'+c+"</a>"+e+"</span></li>");b=a('<div id="'+f+'" class="tabs-panel adapt-height"/>').appendTo(this.element);
a.isFunction(d)&&d.apply(this.element[0],[b])},_adjustScrollLeft:function(){var a=this.element.width(),c=this.element.find(".tabs-header:first"),d=c.find(".active:first");if(d.length!=0){var e=d[0].offsetLeft,f=c[0].scrollLeft;e-f<0?c.scrollLeft(e-50):e-f+d.width()>a-100&&c.scrollLeft(e-a+d.width());c.find(">.tabs-trigger").css("left",c[0].scrollLeft)}},resize:function(){var a=this.element.height()-this.element.find(".tabs-header:first").height();this.element.find(">.tabs-panel.active").css("height",
a||this.options.itemHeight)},removeAll:function(){this.tabs=[];this.element.find(".tabs-header:first>ul").empty();this.element.find(">.tabs-panel").remove()},destroy:function(){this.tabs=null;a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);(function(a){function b(c,d,e){var f=[];f.push('<table cellspacing="0" cellpadding="0"><tr>');a(c).each(function(){f.push("<td>");if(this.name=="split")f.push('<div class="toolbar-split"></div>');else{if(this.children&&this.children.length>0)f.push('<div class="toolbar-toggle"></div><div class="toggle-panel">'),f.push(b(this.children,this.name,this.param));else{var a=["toolbar-item"];this.disabled&&a.push("disabled");a.push(d||this.name);f.push("<div ");e&&f.push(' param="'+e+'" ');this.value&&(f.push(' value="'+
this.value+'" '),a.push(this.value));this.caption&&a.push(" caption");this.method&&f.push(' method="'+this.method+'" ');this.noIcon&&a.push(" noIcon");f.push(' action="'+(d||this.name)+'" ');f.push('title="'+(this.tooltip||this.caption)+'"  class="'+a.join(" ")+'">');f.push(this.caption)}f.push("</div>")}f.push("</td>")});f.push("</tr></table>");return f.join("")}a.widget("youi.toolbar",{_init:function(){this.element.addClass("youi-toolbar").disableSelection();this._initAction()},_initAction:function(){var b=
this.options.commandWidget,d=this.options.commandWidgetId,e=this.options.actions||{};this.element.delegate(".toolbar-item","click",function(){if(!a(this).hasClass("disabled")){var f=this.getAttribute("action"),h=e[f];if(a.isFunction(h))h.apply(this,[]);else if(b&&d&&(h=a("#"+d),h.length!=0))try{h[b](f)}catch(g){if("Error: no such method '"+f+"' for workflowDesigner widget instance"==g){var i=h.data("properties")||{};h[b]("executeCommand",f,i)}}}})},loadItems:function(a){this.element.html(b(a))},_itemHtml:function(a){return b(a)},
active:function(a){if(a)for(var b=0;b<a.length;b++)this.element.find(".toolbar-item.disabled."+a[b]).removeClass("disabled")},disable:function(a){if(a)for(var b=0;b<a.length;b++)this.element.find(".toolbar-item."+a[b]).addClass("disabled")},destroy:function(){}})})(jQuery);(function(a){function b(b){b&&b.length!=0&&(b.addClass("last"),!a.support.boxModel&&b.hasClass("expandable")&&(b.hasClass("expanded")?b.addClass("lastExpanded"):b.addClass("lastExpandable")))}function c(b,c,d,e){var h=["<ul>"],l=d.idAttr||c.idAttr,o=d.textAttr||c.textAttr;a(c.recordPath||"record",e).each(function(){var b=a(l,this).text(),d=a(o,this).text(),g={src:a("src",this).text(),idAttr:a("idAttr",this).text()||l,textAttr:a("textAttr",this).text()||o},e={leaf:a("leaf",this).text(),check:a("check",
this).text()||c.check};h.push(f(b,d,g,e))});h.push("</ul>");b.append(h.join(""))}function d(b,c,d,e){var e=e.records,h=["<ul>"],l=d.leaf?null:c.iteratorSrc,o=c.iteratorParentAttr,n=d.idAttr||c.idAttr,p=d.textAttr||c.textAttr;textAttrs=p.split(".");e.length==0?b.removeClass("expandable").removeClass("expanded").removeClass("lastExpandable").find(">span").removeClass("expandable").removeClass("expanded"):(a(e).each(function(){var b;b=textAttrs.length>1?this[textAttrs[0]][textAttrs[1]]:this[p];var d=
this[n],g=this.src||(!l?null:a.youi.parameterUtils.connectParameter(l,o,d)),e={},k={leaf:this.leaf,check:this.check||c.check,group:this.group};g&&(e={src:this.src||g,idAttr:this.idAttr||n,textAttr:this.textAttr||p});d&&b&&h.push(f(d,c.mixed==true?"("+d+")"+b:b,e,k))}),h.push("</ul>"),b.append(h.join("")))}function e(a){return{src:a.attr("src"),idAttr:a.attr("idAttr"),textAttr:a.attr("textAttr")}}function f(a,b,c,d){var d=d||{},a=['<li id="'+a+'"'],e=["treeNode"],f=["tree-span"],h="";d.leaf!="true"&&
c&&c.src&&(e.push("expandable"),f.push("expandable"),h='<div class="tree-trigger"></div>');d.check&&(e.push("check"),f.push("check"),d.check!=true&&(e.push(d.check),f.push(d.check)));d.group&&(e.push(d.group),f.push(d.group));a.push(' class="'+e.join(" ")+'" ');if(c)for(var n in c)c[n]&&(a.push(n),a.push('="'),a.push(c[n]+'" '));a.push(">");a.push(h);a.push('<span title="'+b+'" '+(f?'class="'+f.join(" ")+'"':"")+'><a class="tree-a" href="#">');a.push(b);a.push("</a></span></li>");return a.join("")}
function h(a,b){var c=a.parent().prev().find(">div");c.find(">span").remove();c.append("<span>&nbsp;["+b+"] </span>")}a.widget("youi.tree",a.extend({},a.ui.mouse,{options:{serverPath:"",srcDataType:"json",dataParse:function(b,i){var i=a.extend({},i,e(this.treeNodeElement)),f=e(this.treeNodeElement);i.srcDataType=="xml"?c(this.treeNodeElement,i,f,b):i.srcDataType=="json"&&d(this.treeNodeElement,i,f,b);return""},root:"\u6839\u8282\u70b9",idAttr:"value",textAttr:"show",autoLoad:true,checkedChildren:true,
checkedParents:true,dragDrop:false,delay:0,distance:1,mixed:false},_create:function(){this.element.addClass("youi-tree").disableSelection();this._initAction();this.options.iteratorSrc&&this.options.autoLoad==true?this.loadIteratorRoot():(this.options.hideRoot==true&&this.element.find(".root>span").hide(),this._expandNode(this.element.find("li.treeNode:first"),this.options.after));this.options.dragable===true&&this._dragDropSupport();this._bindDataFrom()},loadIteratorRoot:function(){if(this.options.iteratorSrc&&
this.element.find("li.root").length==0){var a=this.options,b=this.options.iteratorSrc,b=b+(b.indexOf("?")==-1?"?":"&")+this.options.iteratorParentAttr+"=";this.element.html("").append('<ul><li class="treeNode root" src="'+b+'" code="'+a.idAttr+'" show="'+a.textAttr+'"><span><a>'+a.root+"</a></span></li></ul>");this._loadSrc(this.element.find("li:first"),this.options.after)}},_dragDropSupport:function(){this.options.container=this.options.container||a("body",document);this.element.prepend('<div id="tree-drop-marker" class="tree-drop-marker"></div>');
this._mouseInit()},_mouseStart:function(b){var c=a(b.srcElement||b.target);if(c.is("li>span>a"))this.currentDrag=c.parent().parent(),this.helper=this._createHelper(b,c),this.dropMarker=this.element.find("#tree-drop-marker");return true},_mouseDrag:function(b){var c=a(b.srcElement||b.target);if(this.helper)if(this.position=this._generatePosition(b),this.helper.css(this.position),c.is("li>span>a")&&this.options.dropable){this.currentDrop=c.parent().parent();dropMarker=this.dropMarker;if(this.currentDrop[0]==
this.currentDrag[0]||this.currentDrop[0]==this.currentDrag[0].parentNode.parentNode||a.ui.contains(this.currentDrag[0],this.currentDrop[0]))return this.helper.addClass("drop-no"),dropMarker.removeClass(),false;else this.helper.removeClass("drop-no");var b=b.pageY-c.offset().top-8,d={left:c.offset().left-dropMarker.parent().offset().left-10};b<-3?(d.top=c.offset().top-dropMarker.parent().offset().top-4,dropMarker[0].className="tree-drop-marker marker-top"):b>2?(d.top=c.offset().top+12-dropMarker.parent().offset().top,
dropMarker[0].className="tree-drop-marker marker-bottom"):(d.top=c.offset().top+4-dropMarker.parent().offset().top,dropMarker[0].className="tree-drop-marker marker-middle");a.support.boxModel&&(d.top-=1);dropMarker.css(d)}else if(c.hasClass(this.options.dropStyle)){if(this.currentDrop&&this.currentDrop[0]!=c[0]&&this._dropOut(),!this.currentDrop||this.currentDrop[0]!=c[0])this.currentDrop=c,this._dropOver(c)}else this.currentDrop&&this._dropOut(),this.currentDrop=null},_mouseStop:function(b){if(this.helper)this.currentDrop&&
this.currentDrag&&!this.helper.is(".drop-no")?(this.options.stop=a.isFunction(this.options.stop)?this.options.stop:function(){a(this).tree("dropNode")},this._trigger("stop",b,{dragNode:this.currentDrag,dropNode:this.currentDrop,dragParent:this._getDragParent()}),this._dropOut()):this._trigger("stop",b,{dragNode:this.currentDrag}),this.currentDrop=this.currentDrag=null,this.helper.remove(),this.dropMarker.removeClass(),this.position=this.helper=this.dropMarker=null;return false},_mouseCapture:function(){return true},
_createHelper:function(b,c){var d=a('<span class="drop-yes" id="tree-drop-helper"></span>').append(c.clone());d.parents("body").length||d.appendTo(this.options.container?this.options.container:this.currentDrag);d[0]!=this.element[0]&&!/(fixed|absolute)/.test(d.css("position"))&&d.css("position","absolute");return d},_dropOver:function(b){b.addClass("droping");var c="func_"+this.options.id+"_dropOver";if(a.isFunction(window[c])&&window[c](b)==false)this.currentDrop=null},_dropOut:function(){var b=
"func_"+this.options.id+"_dropOut";this.currentDrop&&this.currentDrop.removeClass("droping");if(this.currentDrop&&a.isFunction(window[b]))window[b](this.currentDrop)},_generatePosition:function(a){var b=a.pageX,a=a.pageY,c=this.options.container?this.options.container.offset():this.element.offset();return{top:a+10-c.top,left:b+5-c.left}},_getDragParent:function(){return this.dropMarker.is(".marker-middle")?this.currentDrop:this.currentDrop.parent().parent()},dropNode:function(){this.currentDrag&&
this.currentDrop&&this._dropNode()},_dropNode:function(){var b=this.dropMarker,c=this.widgetFullName;b.is(".marker-top")&&!this.currentDrop.is(".root")?this._doSelfDrop("before"):b.is(".marker-middle")?this.currentDrop.hasClass("expanded")?this._doSelfDrop():this._expandNode(this.currentDrop,function(){a.data(a(this).parents(".youi-tree:first")[0],c)._doSelfDrop()}):b.is(".marker-bottom")&&!this.currentDrop.is(".root")&&this._doSelfDrop("after")},_doSelfDrop:function(a){this.moveTreeNode(this.currentDrag,
this.currentDrop,a);this.currentDrag=this.currentDrop=null},moveTreeNode:function(a,b,c){this._relativeNodeByRemove(a);switch(c){case "before":this._addBefore(b,a);break;case "after":this._addAfter(b,a);break;default:this._addChild(b,a)}this.selectedNode(null,a);this.currentDrag=this.currentDrop=null},_initAction:function(){this.element.bind("click",function(b){var c=b.target,d;switch(a.youi.classUtils.getEventClass(b)){case "tree-trigger":a(this).tree("triggerNode",a(c.parentNode));break;case "tree-span":d=
a(c.parentNode);break;case "tree-a":d=a(c.parentNode.parentNode)}d&&(d.hasClass("check")&&a(this).tree("checkNode",b,d),a(this).tree("selectedNode",b,d));return false}).bind("dblclick",function(b){var b=a(b.srcElement||b.target),c;b.is("li.treeNode>span>a")&&(c=b.parent().parent());c&&(c.hasClass("expandable")&&a(this).tree("triggerNode",c),a(this).tree("dblclickNode",c));return false}).bind("mousedown",function(b){if(b.button==2){var c=b.target;if(a.youi.classUtils.getEventClass(b)=="tree-a"){b=
"func_"+this.getAttribute("id")+"_rightClick";if(a.isFunction(window[b]))window[b](a(c.parentNode.parentNode));return false}}})},dblclickNode:function(b){a.isFunction(this.options.dblclick)&&this.options.dblclick.apply(b[0])},selectedNode:function(b,c){if(c){var d=this.element.find(".selected");d[0]!=c[0]&&(c.addClass("selected"),c.find("a:first").addClass("selected"),d.removeClass("selected"),d.find("a:first").removeClass("selected"),this._dataFormChange(c[0]),a.isFunction(this.options.select)&&
this.options.select.apply(c[0],[this.element[0]]),a.isFunction(window[this.options.id+"_change"])&&window[this.options.id+"_change"].apply(c[0],[this.element[0],c.attr("id")]))}},_bindDataFrom:function(){if(this.options.dataFormId){var b=a("#"+this.options.dataFormId),c=this.element;if(b.length){var d=this.options.idAttr,e=this.options.textAttr,f=this.options.pidAttr;window[this.options.dataFormId+"_afterSubmit"]=function(f){f.record[d]&&(b.form("fieldValue",d,f.record[d]),f=b.form("getFormRecord"),
b.find(".youi-fieldLayout.tree-binder").css("display")=="none"?c.find("li.treeNode#"+f[d]+">span>a").text(f[e]):c.tree("addNode",null,f[d],f[e],null,null,function(b){c.tree("selectedNode",null,a("#"+b,c))},f.addType=="1"?"child":"after"),h(b,f[e]))};window[this.options.dataFormId+"_afterRemove"]=function(){var a=b.form("getFormRecord");a[d]&&c.tree("removeNode",a[d])};b.delegate("#button_add","click",function(){var a=b.form("getFormRecord");if(a[d]){b.find(".youi-fieldLayout.tree-binder").show();
b.form("clear").form("fieldReset");var c=a[e];a.parentTextTrace&&(c=a.parentTextTrace+" -> "+c);b.form("fillRecord",{addType:"1",parentTextTrace:c});b.find(".youi-field.field-parent").fieldValue(a[d]);h(b,"\u65b0\u589e")}});b.find(".youi-field[property='addType']").fieldRadioGroup("option","change",function(a){var d=c.tree("getSelected");if(d){var e;e=a=="1"?d:d.parent().parent();a=e.attr("id");d=c.tree("getParentTextTrace",e.attr("id"));d=d+" -> "+e.find(">span").text();e.hasClass("root")&&(a="");
b.form("fieldValue",f,a);b.form("fieldValue","parentTextTrace",d)}})}}},_dataFormChange:function(b){if(this.options.dataFormId&&!a(b).hasClass("root")){var c=a("#"+this.options.dataFormId);if(c.length&&c.form){var d=this.options.idAttr,e=this.options.textAttr,f=c.find(".youi-fieldLayout.tree-binder"),b=b.getAttribute("id"),l=this.getParentTextTrace(b);c.form("fieldValue",d,b);c.form("loadRecord",function(a){f.hide();h(c,a[e])},{parentTextTrace:l})}}},checkNode:function(b,c){c.toggleClass("checked").removeClass("partchecked");
c.children("span").toggleClass("checked").removeClass("partchecked");!b.ctrlKey&&this.options.checkedChildren&&(c.hasClass("checked")?c.find(">ul").find(".check").not(".hide").removeClass("partchecked").addClass("checked"):c.find(">ul").find(".check").not(".hide").removeClass("checked").removeClass("partchecked"));!b.ctrlKey&&this.options.checkedParents&&this._checkParentNode(c);a.isFunction(this.options.select)&&this.options.select.apply(c[0],[this.element[0]]);a.isFunction(window[this.options.id+
"_change"])&&window[this.options.id+"_change"].apply(c[0],[this.element[0]])},_checkParentNode:function(a){var b=a.siblings(".check").length,c=a.siblings(".checked").length,d=a.parent().parent(".check");if(d.length!==0){var e=true;a.hasClass("checked")?b==c&&(this._addCheckedClass(d),e=false):!a.hasClass("partchecked")&&c===0&&(this._removeCheckedClass(d),e=false);e&&this._addPartcheckedClass(d);this._checkParentNode(d)}},_addCheckedClass:function(a){a.length>0&&a.addClass("checked").removeClass("partchecked").children("span").addClass("checked").removeClass("partchecked")},
_addPartcheckedClass:function(a){a.length>0&&a.addClass("partchecked").removeClass("checked").children("span").addClass("partchecked").removeClass("checked")},_removeCheckedClass:function(a){a.length>0&&a.removeClass("checked").removeClass("partchecked").children("span").removeClass("checked").removeClass("partchecked")},unCheckedNode:function(a){this._removeCheckedClass(this.element.find("#"+a))},triggerNode:function(a){a.hasClass("expanded")?this._collapseNode(a):this._expandNode(a)},_triggerClass:function(b){b.hasClass("expandable")&&
(b.toggleClass("expanded"),b.children("span").toggleClass("expanded"),a.support.boxModel||(b.is(".last.expanded")?b.addClass("lastExpanded").removeClass("lastExpandable"):b.is(".lastExpanded")&&b.addClass("lastExpandable").removeClass("lastExpanded")))},_expandNode:function(b,c,d){var e=b.attr("src"),c=(d=d||c)&&c;b.hasClass("expanded")||this._triggerClass(b);b.find("ul:first").show();e&&!b.hasClass("loaded")?this._loadSrc(b,c,d):a.isFunction(d)&&d.apply(b[0],[c]);a.support.boxModel||this.element.find(">tree-trigger").css({position:"absolute"});
this.element.scrollTop(0)},_loadSrc:function(b,c,d){var e=this.options,f=b.attr("src"),c=(d=d||c)&&c;b.find("span:first").addClass("loading");a.youi.ajaxUtil.ajax({url:f,dataType:e.srcDataType,contentType:"application/x-www-form-urlencoded;charset=UTF-8",dataParse:e.dataParse,element:this.element,treeNodeElement:b,afterExpand:d,afterExpandData:c,success:function(b){this.dataParse.apply(this,[b,e]);this.treeNodeElement.addClass("loaded").find("span:first").removeClass("loading");b=this.treeNodeElement.find(">ul>li:last");
b.addClass("last");this.treeNodeElement.find("ul:first").show();b.hasClass("expandable")&&b.addClass("lastExpandable");a.isFunction(this.afterExpand)&&this.afterExpand.apply(this.treeNodeElement[0],[this.afterExpandData]);this.afterExpand=this.element=this.treeNodeElement=this.dataParse=null},error:function(){}})},_addChild:function(c,d){var e=c.find(">ul");if(e.length==0)e=a("<ul></ul>").appendTo(c);else{var f=e.find(">li:last");f&&f.length!=0&&f.removeClass("last").removeClass("lastExpanded").removeClass("lastExpandable")}e.children().length==
0&&(c.addClass("expandable expanded").children("span:first").addClass("expandable expanded"),c.hasClass("last")&&c.addClass("lastExpanded"),c.prepend('<div class="tree-trigger"></div>'));b(d);e.append(d)},_addBefore:function(a,b){a.before(b)},_addAfter:function(a,b){a.after(b);a.is(".last")&&(a.removeClass("last").removeClass("lastExpandable").removeClass("lastExpanded"),b.addClass("last"))},_removeNode:function(a){a.length==0||a.hasClass("root")||(this._relativeNodeByRemove(a),this.selectedNode(null,
this._nextNode(a)),a.remove())},_nextNode:function(a){var b=a.next();b.length==0&&(b=a.parent().parent());b.hasClass("root")&&(b=b.find("li.treeNode:first"));return b},_relativeNodeByRemove:function(c){if(c.is(".last")){var d=c.prev(),e=c.parent().parent();d.length>0?b(d):(e.removeClass("expandable").removeClass("expanded"),e.children("span:first").removeClass("expandable").removeClass("expanded"),e.removeClass("lastExpanded").removeClass("lastExpandable"),a.support.boxModel||e.find(">ul").hide());
c.removeClass("last")}},_collapseNode:function(a){this._triggerClass(a);a.find("ul:first").hide()},getSelected:function(){var a=this.element.find("li.treeNode.selected");return a.length==0?null:a},openPath:function(b){if(b){var b=b.split("/"),c=this.element.find("li#"+b.shift());c.length!=0&&(b.length==0?(this.selectedNode(null,c),c.find("a:first").focus()):this._expandNode(c,{treeElement:this.element[0],subPath:b.join("/")},function(b){a(b.treeElement).tree("openPath",b.subPath)}))}},addNode:function(b,
c,d,e,h,l,o){h=f(c,d,e,h);b=b||this.getSelected()||this.element.find("li:first");d=true;if(b&&b.length!=0){switch(o){case "before":this._addBefore(b,a(h));break;case "after":this._addAfter(b,a(h));break;default:!b.hasClass("expandable")||b.hasClass("expanded")?this._addChild(b,a(h)):(d=false,h={tree:this,treeNode:b,addNodeHtml:h,afterAdd:l},this._expandNode(b,h,function(b){(!this.getAttribute("src")||a(this).hasClass("loaded"))&&b.tree._addChild(a(this),a(b.addNodeHtml));a.isFunction(b.afterAdd)&&
b.afterAdd.apply(this,[c])}),h=null)}d&&a.isFunction(l)&&l.apply(b[0],[c])}},removeNode:function(a){a=this.element.find("li.treeNode#"+a);a.length==0&&(a=this.getSelected());this._removeNode(a)},ajaxRemoveNode:function(b,c,d,e){if(b){var f=this.element.attr("id");window.confirm(e||"\u786e\u8ba4\u5220\u9664\uff1f")&&a.youi.ajaxUtil.ajax({url:b,type:"GET",data:a.youi.parameterUtils.propertyParameter(c,d),success:function(){a("#"+f).tree("removeNode",d)}})}},checkedTreeNodes:function(b,c){this.clearCheckedTreeNodes();
a.isArray(b)&&this.expandAll(null,function(){a(this);a("li.treeNode",this).each(function(){var c=this.getAttribute("id");a.inArray(c,b)!=-1&&a(this).addClass("checked").find(">span:first").addClass("checked")})},c?false:b)},checkedTreeNode:function(a){var b=this.element.find("li#"+a);if(b.length>0){var c=[];b.parents("li.treeNode",this.element).each(function(){c.push(this.getAttribute("id"))});c.push(a);this.clearCheckedTreeNodes();this.openPath(c.join("/"));b.addClass("checked").find(">span:first").addClass("checked")}},
getCurrentCheckedIds:function(){var a=[];this.element.find("li.checked,li.partchecked").not(".root").each(function(){a.push(this.getAttribute("id"))});return a},clearCheckedTreeNodes:function(){this.element.find(".checked").removeClass("checked");this.element.find(".partchecked").removeClass("partchecked")},expandAll:function(b,c,d){b||(b=this.element.find("li:first"));this._expandNode(b,{treeElement:this.element},function(b){var e=b.treeElement;a(">ul>li",this).each(function(){e.tree("expandAll",
a(this),c,d)});a.isFunction(c)&&c.apply(this)})},closeAll:function(a){a||(a=this.element.find("li:first"));a.removeClass("expanded");a.find(".expanded").removeClass("expanded");a.find("ul").hide()},getTreeNodePath:function(a,b,c){var c=c||"/",d=[],e=this.element.find("li.treeNode#"+a);e.length&&(e.parents("li.treeNode").not(".root").each(function(){d.push(b?this.getAttribute("code"):this.getAttribute("id"))}),d=d.reverse(),d.push(b?b:a));return d.join(c)},getParentTextTrace:function(b,c){var c=c||
" -> ",d=[],e=this.element.find("li.treeNode#"+b);e.length||(e=this.getSelected());e&&e.length&&(e.parents("li.treeNode").not(".root").each(function(){d.push(a(">span>a",this).text())}),d=d.reverse());return d.join(c)},destroy:function(){this.element.removeData(this.widgetName).removeClass("youi-tree").unbind()}}));a.extend(a.youi.tree,{defaults:{},getter:["getCurrentCheckedIds","getSelected","getTreeNodePath"],treeNodeHtml:function(a,b,c,d){return f(a,b,c,d)}})})(jQuery);
